\documentclass[master]{finthesis}

\usepackage[pdftex]{graphicx}
\usepackage{amsmath}

%\usepackage[style=numeric, sorting=none, defernumbers, maxbibnames=10]{biblatex}

\usepackage{caption}
\usepackage{subcaption}
\captionsetup[figure]{font=footnotesize, justification=centering}
\captionsetup[table]{font=footnotesize, justification=centering}
\usepackage{tikz}
\usepackage{circuitikz}
%\usetikzlibrary{through, patterns}
%\usepackage{tikzscale}

% Used to suppress warning
\usepackage{silence}
\WarningFilter{latex}{Text page 26 contains only floats}

%\usepackage[T1]{fontenc}

\usepackage[dvipsnames]{xcolor} % for more colors
\usepackage{amssymb} % for arrow symbol
\usepackage{tikz, pgfplots} % for diagram
\usepackage{schemabloc}  % for tikz trapezium
\usepackage{booktabs} % for bold lines in table
\usepackage{fancyhdr} % for header and footer
\usepackage{float}
\usepackage{placeins}
% \usepackage{gensymb} % for degree sign

% For group PGF plots
\pgfplotsset{compat=newest}
\usetikzlibrary{pgfplots.groupplots}
\usetikzlibrary{decorations.pathreplacing,angles,quotes}
\usepgfmodule{oo}

\makeatletter
\newcommand*{\engl}[2][\@empty]{%
    \edef\theacronym{#1}%
    (енгл. \foreignlanguage{english}{\emph{#2}%
    \ifx\theacronym\@empty \else , #1\fi})%
}
\makeatother

\newcommand*{\prog}[1]{\texttt{#1}}

% Color variables
\def \CtrlColor        {darkgray}
\def \BBctrlColor      {RoyalBlue}
\def \PIDctrlColor     {OliveGreen}
\def \DCOColor         {BrickRed}
\def \CtrlDecColor     {brown}
\def \CtrlPreprocColor {RoyalPurple}
\def \ClkDivColor      {Goldenrod}
\def \RstnColor        {BurntOrange}

% Abbreviation variables
\def \PLL  {PLL} % phase-locked loop
\def \FLL  {FLL} % frequency-locked loop
\def \DLL  {DLL} % delay-locked loop
\def \DCO  {DCO} % digitally controlled oscillator 
\def \PID  {PID} % proportional-integral-derivative
\def \P    {P}   % proportional
\def \I    {I}   % integral
\def \D    {D}   % derivative
\def \FCW  {FCW} % frequency control word
\def \PVT  {PVT} % process-voltage-temperature
\def \HLLS {HLLS} % high-low level shifter
\def \LHLS {LHLS} % low-high level shifter


\addbibresource{master_rad.bib}

\title{Пројектовање синтетизабилне сведигиталне фреквенцијски затворене петље са широким опсегом подешавања до учестаности од 640\texorpdfstring{\,}{ }MHz}
\author{Ђорђе С. Гачић}
\studid{408/2022}
\advisor{проф. др Владимир М. Миловановић}
\advisorfull{Др Владимир М. Миловановић,\\ванредни професор}

\studprog{Електротехника и рачунарство}
% \module{Модул}
\course{Анализа и пројектовање алгоритама}
\date{\today}
% \date{ГГГГ-ММ-ДД}

\committee{др Шћепан Шћекић}
\committee{доц. др Жарко Попара}

\studentshould{% У оквиру овог рада кандидат треба да...
реализује дигиталну фреквенцијски затворену петљу у стандардној 130\,nm CMOS технологији, за циљану учестаност рада до 640\,MHz. Систем треба да се састоји од дигитално контролисаног осцилатора у облику матрице тростатичких инвертора коме претходи управљачка логика која омогућава брзо достизање и стабилно одржавање жељене радне учестаности која је задата целобројним умношком у односу на референтну фреквенцију од 16\,MHz. Приказати резултате симулација у најгорим, типичним и најбољим условима рада узимајући у обзир напон напајања, температуру и процесни угао. Потребно је теоријски обрадити структуру система као и појаве које се запажају у резултатима симулација. У сврху додатне провере исправности рада система, потребно је направити модел система у програмском језику Пајтон који треба веродостојно симулирати рад свих компоненти система и упоредити пар различитих контролера укључујући и стандардни ПИД (пропорционално, интегрални, диференцијални) контролер.
}

%\titlepagebib{greenwade93}
%\titlepagebib{pythonsite}
\titlepagebib{Staszewski:FREQUENCY_SYNTHESIZER_CMOS_2005}
\titlepagebib{Razavi:PLL_CMOS_2020}

\thesisapplicationfile{slike/prijava}

\abstracten{Frequency-locked loop (FLL) represents a viable way of generating a range of frequencies from a single reference frequency by using a negative feedback electronic control system that compares the frequency of a controlled oscillator to the reference one. A digital synthesizable FLL is designed in 130\,nm CMOS technology for a target frequency of up to 640\,MHz. It employs a wide-tuning range digitally controlled oscillator (DCO) assembled from tri-state inverters in the form of a matrix. The FLL can optionally use a bang-bang or a soft-programmable standard proportional-integral-derivative (PID) controller to regulate the feedback loop. Its design practically minimizes metastability occurrence. The proposed digital FLL occupies 100\,\textmu m $\times$ 330\,\textmu m and consumes 3.5\,mW in typical operating conditions. The reference clock is 16\,MHz, and the output oscillation frequency is set to 640\,MHz, while the achieved frequency resolution is 2.8\,MHz. The system is additionally modeled in software using the Python programming language. A comparison of the characteristics of DCOs designed in 130\,nm and 180\,nm TSMC technologies is also provided.}
\keywordsen{Frequency-locked loop, digitally controlled oscillator, clock generator, synthesizable, CMOS technology, PID controller, metastability, Python model}

\abstractsr{Фреквенцијски затворена петља \engl[FLL]{Frequency-Locked Loop} представља одржив начин генерисања опсега фреквенција из једне референтне фреквенције коришћењем електронског система управљања са негативном повратном спрегом, који пореди фреквенцију контролисаног осцилатора са поменутом референтном фреквенцијом. Дигитални синтетизабилни \FLL\ је дизајниран у 130\,nm технологији за циљану фреквенцију до 640\,MHz. Он садржи дигитално контролисани осцилатор \engl[DCO]{Digitally Controlled Oscillator} са широким подешавањем опсега који се састоји од тростатичких инвертора у облику матрице. \FLL\ може произвољно користити двостепени \engl{Bang-bang} контролер или софтверски програмабилни стандардни пропорционално, интегрални, диференцијални \engl[PID]{Proportional-Integral-Derivative} контролер за управљање повратном спрегом. Такав дизајн у пракси минимизује појаву метастабилности. Предложени дигитални \FLL\ заузима површину од 100\,\textmu m $\times$ 330\,\textmu m и троши 3,5\,mW у типичним условима рада. Референтни такт је 16\,MHz, а излазна фреквенција осциловања је подешена на 640\,MHz, док постигнута резолуција фреквенције износи 2,8\,MHz. Систем је додатно софтверски моделиран у Пајтон програмском језику. Такође је дато поређење карактеристика \DCO-а пројектованих у 130\,nm и 180\,nm TSMC технологијама.}
\keywordssr{Фреквенцијски затворена петља, дигитално контролисани осцилатор, генератор такта, синтетизабилност, CMOS технологија, \PID\ контролер, метастабилност, Пајтон модел}

% Semantic markup. Look it up!
%\newcommand{\cmd}[2][]{\texttt{\textbackslash #2#1\{\ldots\}}} % Well, this one is useful beyond just semantics...
%\newcommand{\env}[1]{\texttt{#1}}
%\newcommand{\pkg}[1]{\texttt{#1}}
%\newcommand{\prog}[1]{\texttt{#1}}

\begin{document}

\maketitle

\tableofcontents

\makeabstract

\section{Увод}
У данашње вријеме, фазно затворена петља \engl[PLL]{Phase-Locked Loop} и петља са затвореним кашњењем \engl[DLL]{Delay-Locked Loop} представљају свеприсутне блокове у дизајну чипова. Безброј примјена самих чипова захтијевају или генератор такта или синтетизатор фреквенције, што подразумијева уградњу неког од поменутих блокова унутар система који се пројектује. Главна улога таквог блока у дизајну је да генерише стабилан и прецизан излазни сигнал чија је фаза подесива у односу на фазу улазног сигнала, самим тим одржавајући везу између улазне и излазне фреквенције. Међутим, чак и веома сложени системи често захтијевају генератор такта, који само множи улазну фреквенцију без да посебно води рачуна о фази такта или апсолутном џитеру \engl{Jitter}. У таквим примјенама, потребна и довољна је само фреквенцијски затворена петља \engl[FLL]{Frequency-Locked Loop} да би се испунили тражени захтјеви. \par
Постоје многи начини имплементације \FLL-а~\cite{Ali:9097205}. Штавише, \FLL\ као интегрисано коло може се сврстати у двије групе: дигитални и аналогни \FLL. Иако је очигледан недостатак првог максимална фреквенција и њена резолуција, они посједују многе друге предности наспрам њихових аналогних парњака. Заузимају мање простора, истичу се већом отпорношћу на промјене процесних углова, напона и температуре \engl[PVT]{Process-Voltage-Temperature}, лако су преносиви у различите технологиjе, и стога омогућаваjу поновну употребу, скалирање, jедноставниjу методологиjу, као и брже циклусе проjектовања. Узимајући у обзир све претходно поменуто, испоставља се да је у општем случају боље ићи ка развоју дигиталног \FLL-a кад год спецификација архитектуре система то дозвољава. \par
% Дакле, фокус овог рада је пројектовати и унаприједити једноставне али моћне синтетизабилне дигиталне блокове чипа. \par
Овај рад конкретно предлаже синтетизабилни дигитални \FLL\ сличан предложеном у литератури~\cite{Musa:6644316}, са побољшаном брзином закључавања \FLL-а~\cite{Deng:6891375} и смањеним ризиком од метастабилности. Осцилатор је састављен од тростатичких инвертора и заснован на прстенастом \DCO-у из литературе~\cite{Tierno:4443210}, измијењен додавањем независног напона напајања \DCO-а са претварачима напонских нивоа \engl{Level Shifters} и употребом петостепене~\cite{Rylyakov:4523284} умјесто тростепене толологије прстена осцилатора. \par
У поглављу~\ref{FLL structure} се даје основни опис рада и структуре предложеног дигиталног \FLL-а. Управљачка логика \FLL-a је детаљно описана у поглављу~\ref{section:ctrl}. Теоријскa разматрања осцилатора, као главне компоненте у систему дата су у поглављу~\ref{Oscillation basics}, док је коришћени дигитално контролисан осцилатор описан у поглављу~\ref{DCO chapter}. Поглавље~\ref{Implementation and results} садржи анализиран код на нивоу регистара \engl[RTL]{Register-Transfer Level} и лејаут \FLL-а и његових појединачних компоненти, а дат је и увид у имплементацију и добијене резултате симулација, такође уз теоријска разматрања појава које су од значаја за рад читавог система. У поглављу~\ref{section:python_model} описан је значај софтверског моделирања система и приказана је имплементација модела понашања \FLL-a у Пајтон програмском језику. У сврху поређења карактеристика осцилатора у различитим технологијама, рад садржи поглавље~\ref{section:compare_tech}. Коначно, поглавље \ref{Conclusion} закључује рад и наговјештава могућности даљег рада на побољшању и проширењу система.


\section{Опис и структура фреквенцијски затворене петље} \label{FLL structure}
По дефиницији, \FLL\ је управљачки систем са негативном повратном спрегом који закључава фреквенцију излазног сигнала на предвиђену циљану фреквенцију. У принципу, непрестано управља фреквенцијом осцилатора на аутоматски начин све док излазна фреквенција не достигне циљану вриједност, након чега се та вриједност фреквенције одржава на излазу. То значи да \FLL\ спада у синтетизаторе фреквенције који се уопштено описују као активна електронска кола која имају неки сигнал са референтном и веома стабилном фреквенцијом ($f_\text{REF}$) на улазу и затим генеришу излазни сигнал са фреквенцијом ($f_\text{OUT}$) која представља референтну фреквенцију помножену са одговарајућим чиниоцем тј. умношком фреквенције (FMUL) као у једначини~\ref{eq:fll:fout}.
\begin{equation}
	\label{eq:fll:fout}
	f_\text{OUT} = \text{FMUL} \cdot f_\text{REF}
        \vspace{0.3cm}
\end{equation}
Треба напоменути да је стабилност, прецизност и спектрална чистоћа излазног сигнала у константној вези са квалитетом сигнала на улазу~\cite{Staszewski:FREQUENCY_SYNTHESIZER_CMOS_2005}. \figurename~\ref{fig:fll:fref_fout} приказује поједностављен дигитални сигнал на улазу (REF) и излазу (OUT) система са одређеном вриједношћу умношка фреквенције. \par
% TODO
% Направити сигнале и пребацити у TikZ слику испод
%\begin{figure}[!h]
%	 \centering
%	 \includegraphics[scale=0.7]{slike/fll_fref_fout.png}
%	 \caption{Демонстарција рада синтетизатора фреквенције за FMUL=4.}
%	 \label{fig:fll:fref_fout}
%\end{figure}
\input{slike/fll_fref_fout.tex}
\begin{equation}
	f_\text{REF} = \frac{1}{T_\text{REF}}
        \vspace{0.2cm}
\end{equation}
\begin{equation}
	f_\text{OUT} = \frac{1}{T_\text{OUT}}
        \vspace{0.3cm}
\end{equation}
Дефиниција изнад не предвиђа облик синтетисаног излазног сигнала. Он може бити синусоида или правоугаони (дигитални) сигнал, који нам је у CMOS технологији дефинитивно кориснији за разматрање. \par 
У овом раду описана је релативно једноставна али ефикасна дигитална фреквенцијски затворена петља чију системску архитектуру на нивоу блокова приказује \figurename~\ref{FLL block diagram}. Описани \FLL\ се практично састоји из два блока: дигитално контролисаног осцилатора и блока управљачке логике, који генерише улазне сигнале осцилатора на основу тренутне фреквенције \DCO-a. У сврху поједностављења, са слике су изостављени неки конфигурациони улази \FLL-a, као што су коефицијенти \PID\ контролера или улаз за одабир режима рада, чија улога је детаљније описана у поглављу~\ref{Implementation and results}. \par

\input{slike/FLL.tex}
\vspace{0.7cm} % go to next page
Основни улази у систем су:
\begin{itemize}
	\item RSTN - Ресет сигнал који је активан на нулу,
	\item FREF - Референтни такт,
	\item FMUL - Улазни умножак фреквенције (множењем са фреквенцијом референтног такта добија се вриједност фреквенције коју треба постићи и одржавати на излазу),
	\item CTRL - Сигнал који одређује који од два управљачка режима се користи.
\end{itemize}
Излази из система су:
\begin{itemize}
	\item FOUT - Излазни такт,
	\item LOCK - Сигнал који говори да ли је систем ушао у стабилно стање тј. да ли ради на жељеној фреквенцији.
\end{itemize}

\section{Управљачка логика дигиталне фреквенцијски затворене петље} \label{section:ctrl}
Управљачка логика \FLL-a састоји се од двије независне процесне гране, које представљају два међусобно искључива режима управљања \FLL-a. Оба режима на улазу примају бинарну вриједност која представља број периода такта \DCO-а унутар периода референтног такта. Такође, оба управљачка режима генеришу бинарну вриједност на излазу, која представља управљачку бинарну ријеч осцилатора директно пропорционалну излазној фреквенцији. Главне разлике између два поменута режима су брзина затварања (закључавања) \FLL-a и једноставност подешавања. Циљ управљачке логике \FLL-a је изједначити вриједност улазног множача фреквенције са бројем периода такта \DCO-a унутар периода референтног такта што је брже и прецизније могуће, чиме се долази до постизања жељене фреквенције на излазу \DCO-a. Поред самог постизања жељене фреквенције, задатак управљачке логике је и њено одржавање током времена јер, због утицаја разних фактора, као што је нпр. температура, константно долази до нежељеног смањења или повећања вриједности фреквенције. То значи да управљачка логика константно прати рад система и по потреби реагује на исход непожељних утицаја на излазну фреквенцију. Комплетна управљачка логика \FLL-a је подијељена на неколико фаза, које су детаљно описане у наредним поглављима, а то су:
\begin{itemize}
	\item Управљачка предобрада
	\item Двостепени контролер / \PID\ контролер
	\item Управљачки декодер
\end{itemize}

\subsection{Управљачка предобрада} \label{section:control_preprocessing}
Фаза управљачке предобраде \engl{Control Preprocessing} укључује неколико блокова чија је улога претворити информацију о фреквенцији излазног такта \DCO-a у бинарну вриједност која ће бити прослијеђена као улаз наредној фази управљачке логике \FLL-a. Као прво, да би се одредила брзина осциловања \DCO-a, потребан је бројач. У имплементацији описаној у овом раду коришћен је Грејев бројач. У Грејевом коду свака узастопна вриједност се разликује за само један бит. То му даје предност у односу на природни бинарни бројач из разлога што значајно умањује метастабилност бројача изазвану узорковањем \engl{Sampling} вриједности бројача. \tablename~\ref{gray_code} приказује првих осам цифара у Грејевом коду, у поређењу са природним бинарним цифрама. \par
\begin{table}[!ht]
	\caption{Првих осам цифара у Грејевом коду}
	\label{gray_code}
	\centering
	\begin{tabular}{|c|c|c|c|}
		\hline
		Децимални запис & Бинарни запис & Грејев код & Грејев код у децималном запису \\
		\specialrule{1pt}{0pt}{0pt}
		0 & 000 & 000 & 0 \\
		\hline
		1 & 001 & 001 & 1 \\
		\hline
		2 & 010 & 011 & 3 \\
		\hline
		3 & 011 & 010 & 2 \\
		\hline
		4 & 100 & 110 & 6 \\
		\hline
		5 & 101 & 111 & 7 \\
		\hline
		6 & 110 & 101 & 5 \\
		\hline
		7 & 111 & 100 & 4 \\
		\hline
	\end{tabular}
\end{table}
Као примјер појаве метастабилности може се навести проблем који се може јавити у употреби природних бинарних кодова, а то је да се, при преласку у наредно стање бројача, стање свих битова који се мијењају не мора промијенити тачно синхронизовано. Рецимо, при преласку из стања 3 у стање 4 (бинарно 011 у 100), код природног бинарног бројача сви битови мијењају стање, тако да та транзиција може да иде редом 011 $\rightarrow$ 001 $\rightarrow$ 101 $\rightarrow$ 100, што значи да могу да постоје два прелазна стања, која могу бити прочитана чиме би коначно стање бројача било погрешно. У овом конкретном случају, умјесто у стање 4 (бинарно 100), бројач би завршио у стању 1 (бинарно 001) или 5 (бинарно 101), за шта не постоји могућност при употреби Грејевог кода јер се у њему из стања 011 прелази у стање 010, при чему се мијења само један бит. Треба напоменути да могућност појаве метастабилности и даље постоји јер је то много општија појава иза проблема погрешног узорковања у случају када се у исто вријеме мијењају такт и подаци, али Грејев код омогућује да се потенцијална грешка сведе на максимално један бит. \par 
Недостатак овог приступа је то што имплементација Грејевог бројача из овог рада има мању максималну радну фреквенцију од природног бинарног бројача. Да би се значајно више смањио ризик од метастабилности, сваки бит са излаза Грејевог бројача се пропушта кроз синхронизатор са два флип-флопа да би безбједно прешао у подручје референтног такта. Затим, синхронизована вриједност Грејевог бројача се претвара у природан бинарни формат и узоркује се за даљу обраду.

\subsection{Двостепени контролер} \label{section:bang_bang}
У теорији управљања, двостепени контролер (двофазни, bang-bang или on-off контролер) је контролер повратне спреге које се нагло пребацује између два стања. Математички модел двостепеног контролера може се представити преко Хевисајдове функције (или јединичне одскочне функције) која се иначе користи у математици система управљања и обради сигнала да би се представио сигнал који мијења стање у одређено вријеме. Она има вриједност $0$ за негативне вриједности аргумента и $1$ за позитивне вриједности аргумента:
% TODO
% Пребацити у TikZ слику испод
%\begin{figure}[!h]
%	 \centering
%	 \includegraphics[scale=0.7]{slike/heaviside.png}
%	 \caption{График Хевисајдове функције.}
%	 \label{heaviside}
%\end{figure}
\input{slike/heaviside.tex}
\begin{equation}
	\label{eq_heaviside}
	u(x)= \begin{cases}
		0, & x < 0 \\
		1, & x > 0
		\end{cases}
\end{equation}
Главне предности примјене двостепеног контролера су једноставна имплементација и брз одговор на промјене, док су недостаци могуће осцилације око жељене вриједности након што се она постигне, као и непогодност за системе гдје је потребно веома прецизно управљање. \par 
Kao што је већ наведено, \FLL\ из овог рада има два међусобно искључива управљачка блока. Један управљачки блок \FLL-a је веома сличан двостепеном контролеру описаном изнад. Он пореди улазни умножак фреквенције са узоркованом вриједношћу бројача и одлучује да ли инкрементирати, декрементирати или онемогућити предстојећи блок тј. двосмјерни бројач \engl{Up-Down Counter}. Ако је улазни умножак фреквенције већи од вриједности бројача узорковане у блоку управљачке предобраде, тада се двосмјерни бројач инкрементира, ако је мањи тада се декрементира, а у случају да је једнак, двосмјерни бројач задржава претходно стање. То осигурава постепено управљање и закључавање све до постизања жељене фреквенције тј. преласка у стабилно стање. Како би се спријечиле (или барем прориједиле) могуће осцилације око жељене вриједности, у овом блоку је доведен додатни сигнал који омогућава да се, након што систем једном уђе у стабилно стање, бројач двостепеног контролера не инкрементира или декрементира баш након сваког одступања од жељене вриједности јер се очекује да у стабилном стању та одступања буду незнатна. Тај додатни сигнал се користи и у \PID\ контролеру који представља други управљачки режим о коме ће више ријечи бити у наредном поглављу.

\subsection{\PID\ контролер} \label{section:pid}
У другом управљачком режиму, управљачка бинарна ријеч за \DCO\ се генерише подесивим \PID\ контролером. \PID\ контролер је далеко најчешће коришћен алгоритам за управљање у инжењерству. Највећим бројем повратних спрега се управља преко \PID\ контролера или његових дјелимичних варијација~\cite{Astrom:PID_1995}. \PID\ контролер је управљачки механизам заснован на повратној спрези, који ради тако што непрекидно исправља и скалира сигнал грешке. Грешка у овом случају представља разлику између измјерене вриједности у управљачкој предобради (узоркована вриједност бројача) и жељене референтне задате вриједности (вриједност улазног умношка фреквенције). Исправљање и скалирање се распоређује у три компоненте које су имплементиране помоћу подесивих коефицијената, цијелих бројева у бинарном формату са фиксном тачком, добијених из регистарске банке: 
\begin{itemize}
	\item Пропорционална (\P) - управља брзином одзива управљачког системам непосредно множећи сигнал грешке константним чиниоцем који се назива и константа пропорционалног појачања. Ако је она превелика, систем може постати нестабилан. Насупрот томе, њена премала вриједност доводи до малог излазног одзива на велику улазну грешку чиме контролер постаје мање осјетљив. 
	\item Интегрална (\I) - користи се за смањење грешке стабилног стања \engl{Steady State} скалирањем грешке константним чиниоцем и сумирањем резултата током времена. Грешка стабилног стања је разлика између жељене и стварне вриједности коначног излаза~\cite{Liptak:PROCESS_CONTROL_2006}. Интегрално дејство убрзава кретање излаза ка жељеној вриједности.
	\item Диференцијална (\D) - пропорционална брзини промјене грешке, и њен циљ је ограничити излаз да би се смањила могућа прекорачења или осцилације узроковане \P\ и \I\ компонентама, без смањења брзине контролера. Како је у овом систему референтна задата вриједност константна и нема брзих промјена на улазу које могу изазвати такав исход, \P\ и \I\ компоненте су довољне за гладак и стабилан одзив система. \par
\end{itemize}
Математички, цјелокупна управљачка функција \PID\ контролерa представља суму пропорционалног, интегралног и диференцијалног дејства и записује се на следећи начин:
\begin{equation} 
	\label{eq_pid_1}
	y(t)= K_\text{p}e(t) + K_\text{i}\int_{0}^{t}e(\tau)d\tau + K_\text{d}\frac{de(t)}{dt},
\end{equation}
гдје су $K_\text{p}$, $K_\text{i}$ и $K_\text{d}$ коефицијенти за пропорционални, интегрални и диференцијални дио, респективно. У стандардном облику, једначина~\ref{eq_pid_1} се записује као
\begin{equation} 
	\label{eq_pid_2}
	y(t)= K_\text{p}\left(e(t) + \frac{1}{T_\text{i}}\int_{0}^{t}e(\tau)d\tau + T_\text{d}\frac{de(t)}{dt}\right).
\end{equation}
Као што се може видјети, коефицијенти $K_\text{i}$ и $K_\text{d}$ су редом замјењени са $K_\text{p}/T_\text{i}$ и $K_\text{p}T_\text{d}$, а предност таквог записа јесте што $T_\text{i}$ и $T_\text{d}$ имају одређено разумљиво физичко значење, јер представљају интегрално и диференцијално вријеме, респективно. $K_\text{p}/T_\text{i}$ одређује колико временски дуго ће контролер толерисати излаз који се налази изнад или испод жељене вриједности. $K_\text{p}T_\text{d}$ је временска константа којом се контролер покушава приближити жељеној вриједности. \par
% TODO
% Пребацити у TikZ слику испод
%\begin{figure}[!h]
%	 \centering
%	 \includegraphics[scale=0.3]{slike/pid.png}
%	 \caption{Блок дијаграм \PID\ контролера у повратној спрези.}
%	 \label{pid_img}
%\end{figure}
\input{slike/pid.tex}
\figurename~\ref{pid_img} представља уопштен блок дијаграм \PID\ контролера у повратној спрези који приказује структуру компоненти контролера и њихов принцип рада. \PID\ контролер константно рачуна вриједност грешке $e(t)$ као разлику између жељене вриједности \engl{Setpoint} $u(t)$, која у овом конкретном случају представља улазни умножак фреквенције, и измјерене процесне вриједности $y(t)$, односно вриједности измјерене у блоку управљачке предобраде. У том случају, једначина грешке може се записати као
\begin{equation} 
	\label{eq_pid_err)}
	e(t) = u(t) - y(t).
\end{equation}
Одзив система тј. брзина и начин достизања жељене фреквенције у \PID\ режиму рада највише зависи од одабира константи контролера, а у овом раду је остављена могућност софтверског уписа константи у регистре, што даље омогућава њихово накнадно мијењање и прилагођавање. У поглављу~\ref{section:python_model}, гдје је приказан софтверски модел понашања \FLL-a имплементиран у Пајтон програмском језику, поред осталог је дат и сликовит приказ утицаја константи \PID\ контролера на одзив система.

\subsection{Управљачки декодер} \label{section:control_decoder}
Улога управљачког декодера је претворити управљачке податке из једне бинарне вриједности у скуп управљачких улаза \DCO-а. Постоје три таква улаза: \textit{Row On}, унарни вектор, који може да укључује само читаве редове тростатичких инвертора \DCO-a; \textit{Row Select}, један од $n$ \engl{One-Hot} вектор, који укључује један додатни ред тростатичких инвертора \DCO-a; и \textit{Column Select}, унарни вектор, који може да укључује колоне тростатичких инвертора \DCO-a. \par
Један од $n$ вектор представља групу битова гдје је једина исправна комбинација она са једном јединицом и свим осталим нулама~\cite{Harris:DIGITAL_DESIGN_2012}. При представљању неког природног броја као један од $n$ вектора, вриједност броја је једнака позицији јединице у вектору. С друге стране, да би се природан број $N$ представио као унарни вектор, јединица се понавља $N$ пута узастопно~\cite{Davis:COMPUTABILITY_1994}. \tablename~\ref{one_hot_unary} приказује примјер представљања природних бројева у унарном и један од $n$ запису. \par
\begin{table}[!ht]
	\caption{Поређење унарног и један од $n$ записа}
	\label{one_hot_unary}
	\centering
	\begin{tabular}{|c|c|c|c|}
		\hline
		Децимални & Бинарни & Унарни & Један од $n$ \\
		\specialrule{1pt}{0pt}{0pt}
		0 & 000 & 00000000 & 00000001 \\
		\hline
		1 & 001 & 00000001 & 00000010 \\
		\hline
		2 & 010 & 00000011 & 00000100 \\
		\hline
		3 & 011 & 00000111 & 00001000 \\
		\hline
		4 & 100 & 00001111 & 00010000 \\
		\hline
		5 & 101 & 00011111 & 00100000 \\
		\hline
		6 & 110 & 00111111 & 01000000 \\
		\hline
		7 & 111 & 01111111 & 10000000 \\
		\hline
	\end{tabular}
\end{table}
Да би се инвертор укључио, или \textit{Row On}, или и \textit{Row Select} и \textit{Column Select} за одговарајући бит морају бити подешени на 1 (једначина~\ref{dco_cell_ctrl_eq}). Ширина сваког вектора је једнака ширини улаза \DCO-а. Структура \DCO-a је детаљно описана у поглављу \ref{DCO chapter}. \par 
Управљачки податак који долази из претходног степена тј. контолера представља број тростатичких инвертора \DCO-а који требају бити укључени, и што их је више укључено, то је излазна фреквенција већа. Рецимо да је тај број 50, и претпоставимо да је \DCO\ састављен од 255 тростатичких инвертора које поједностављено можемо посматрати као прекидаче и нека су организовани у 17 редова и 15 колона. Како постоји 17 редова, ширине \textit{Row On} и \textit{Row Select} вектора биће по 17 битова, док ће због 15 колона, ширина \textit{Column Select} вектора бити 15 битова. То значи, да би се укључило 50 прекидача, потребно је укључити 3 читава реда прекидача и још 5 прекидача из четвртог реда. Да би се то постигло, управљчки улази \DCO-а морају имати следеће вриједности:
\begin{itemize}
	\item \textit{Row On} = $00000000000000111$ $\rightarrow$ Сви прекидачи у три прва реда су укључени. 
	\item \textit{Row Select} = $00000000000001000$ $\rightarrow$ У четвртом реду је укључено још инвертора.
	\item \textit{Column Select} = $000000000011111$ $\rightarrow$ Пет инвертора је укључено у реду који је одређен са \textit{Row Select}.
\end{itemize}

\section{Теоријско разматрање осцилатора} \label{Oscillation basics}
У срцу сваке фазно затворене петље се налази осцилатор који игра кључну улогу у учинку који може бити постигнут~\cite{Razavi:PLL_CMOS_2020}. Имајући то у виду, у наставку ће кроз теорију и примјере бити описани основни концепти осциловања, а након тога се прелази на разматрање концепта дигитално контролисаног осцилатора. \par

\subsection{Основни принципи осциловања}
У сврху теоријског разматрања осцилатора, као примјер биће узето клатно, као на Слици~\ref{pendulum}. \par
\input{slike/pendulum.tex}
Ако пустимо клатно под одређеним углом, оно се неко вријеме њише и постепено се зауставља. Осцилација почиње јер се првобитна потенцијална енергија претвара у кинетичку енергију како клатно достиже свој вертикални положај, дозвољавајући му да настави своју путању до другог екстремног угла (положај 3), под којим је енергија поново у потенцијалном облику. У реалним условима осцилација престаје јер трење на оси око које се окреће клатно и отпор ваздуха претварају дио енергије клатна у топлоту у сваком периоду осциловања. \par
Да би се одржала осцилација, потребно је обезбиједити спољну енергију клатну, како би се надомјестио губитак изазван трењем на оси и отпором ваздуха. Рецимо ако се лагано гурне клатно сваки пут када се врати у положај 1, оно ће настављати да се њише. Ако је притисак сувише слаб, врши се недовољна компензација, чиме се дозвољава осцилацији да ослаби и временом нестане. С друге стране, ако је притисак прејак, врши се прекомјерна компензација, приморавајући амплитуду замаха да се повећава из једног циклуса у други. Такође, треба напоменути да је период осциловања независан од амплитуде осциловања~\cite{Razavi:PLL_CMOS_2020}. \par
Механички примјер изнад указује на неколико саставних дијелова осцилаторног система:
\begin{enumerate}
	\item Почетна „неравнотежа“, тј. почетно стање или количина енергије (обезбијеђена довођењем клатна у положај 1).
	\item Склоност да се једна врста енергије претвара у другу и обрнуто.
	\item Механизам за одржавање који допуњује енергију изгубљену усљед неизбјежних несавршености.
\end{enumerate}
Не садрже сви осцилаторни системи све поменуте саставне дијелове, али је корисно имати ове концепте на уму при разматрању неког система који осцилује. \par
Ако се идеално клатно (клатно без губитака) пусти под одређеним углом, такво клатно осцилује бесконачно. Ако се дода одређени притисак сваки пут када клатно дође до лијевог краја, тада замах наставља да расте због додатне енергије која се уноси у систем у сваком циклусу. Треба имати на уму да се тај неограничени раст не дешава ако се додатни притисак унесе на фреквенцији различитој од природне фреквенције осциловања клатна. Ако систем има склоност да осцилује на фреквенцији $\omega_{0}$, тада се ствара растући осцилаторни излаз као одговор на спољашњу побуду на фреквенцији $\omega_{0}$. Из друге перспективе, такав систем неограничено појачава периодични улаз на поменутој фреквенцији.

\subsection{Систем осцилаторне повратне спреге}
Из основа аутоматског управљања се зна да систем са негативном повратном спрегом може постати нестабилан. Ово својство се користи за конструисање осцилатора. \par
У сврху проучавања осцилација у фреквенцијском домену, разматрамо систем повратне спреге приказан на Слици~\ref{osc_feedback_1}, гдје негативан предзнак на једном улазу сабирача означава негативну повратну спрегу на ниским фреквенцијама. На Слици~\ref{osc_feedback_2} је приказан примјер имплементације такве повратне спреге, који, на нискофреквентни синусоидни улаз дјелује као јединични бафер. Треба имати на уму да операциони појачавач показује занемарљив фазни помак на ниским фреквенцијама. \par
% TODO
% Пребацити у TikZ слике
%\begin{figure}[!ht]
%	 \centering
%	 \includegraphics[scale=0.8]{slike/osc_feedback_1.png}
%	 \caption{Једноставан систем повратне спреге.}
%	 \label{osc_feedback_1}
%\end{figure}
\input{slike/osc_feedback_1.tex}
%\begin{figure}[!ht]
%	 \centering
%	 \includegraphics[scale=0.8]{slike/osc_feedback_2.png}
% 	 \caption{Реализација повратне спреге коришћењем операционог појачавача.}
%	 \label{osc_feedback_2}
%\end{figure}
\input{slike/osc_feedback_2.tex}
Међутим, поставља се питање како могу системи са Слика~\ref{osc_feedback_1}~и~\ref{osc_feedback_2} да осцилују? Записивањем преносне функције затворене петље као 
\begin{equation} 
	\label{transfer_function}
	\frac{Y(s)}{X(s)}=\frac{H(s)}{1+H(s)},
\end{equation}
примјећује се да именилац пада на нулу ако је $H(s)=-1$ за неку вриједност промјенљиве $s$. Ако је $X(s)$ синусоида, онда је $s=j\omega_{0}$ и мора важити $H(j\omega_{0})=-1$. С обзиром да је у питању синусоида, то ће на $\omega_{0}$ важити за фазни помјерај од $-180^{\circ}$. То даље значи да важи $(Y/X)(j\omega_{0}) \rightarrow \pm\infty$, одакле се може закључити да систем обезбјеђује неограничен добитак за такву синусоиду. Као што је претпостављено у претходним поглављу, такво понашање наговјештава осцилаторну петљу. \par
Једнакост $H(j\omega_{0})=-1$ значи да $H(s)$ инвертује улаз на фреквенцији $\omega_{0}$, што је илустровано на Слици~\ref{osc_feedback_3}. Другим ријечима, $H(s)$ има толико помјерања фазе (или кашњења) на $\omega_{0}$ да укупна повратна спрега постаје позитивна. То се може видјети постављањем главног улаза, $X(s)$, на нулу, прекидом петље и примјеном стимулуса на истој фреквенцији (\figurename~\ref{osc_feedback_4}). Враћени сигнал је у фази са испитним напоном, $V_{t}$. У овом случају, каже се да петља садржи фазни помјерај од $180^{\circ}$ због номинално негативне повратне спреге и други, фреквенцијски зависан, фазни помјерај од $180^{\circ}$ који произилази из $H(s)$. Та два фазна помјераја се не смију мијешати један с другим. \par
%\begin{figure}[!ht]
%	 \centering
%	 \includegraphics[scale=0.8]{slike/osc_feedback_3.png}
%	 \caption{Инверзија сигнала на фреквенцији $\omega_{0}$.}
%	 \label{osc_feedback_3}
%\end{figure}
\input{slike/osc_feedback_3.tex}
%\begin{figure}[!ht]
%	 \centering
%	 \includegraphics[scale=0.8]{slike/osc_feedback_4.png}
%	 \caption{Пропагација синусоиде кроз петљу на фреквенцији $\omega_{0}$.}
%	 \label{osc_feedback_4}
%\end{figure}
\input{slike/osc_feedback_4.tex}
Укупан фазни помјерај од $360^{\circ}$ на $\omega_{0}$ имплицира да се сигнал враћа да би се појачао док кружи у петљи. Ова појава доводи до пораста амплитуде јер је враћени сигнал бар толико велик као и почетни сигнал, односно зато што је $|H(j\omega_{0})|=1$. Стога се услови за осциловање сумирају као:
\begin{equation} 
	\label{osc_condition_1}
	|H(j\omega_{0})| = 1
\end{equation}
\begin{equation} 
	\label{osc_condition_2}
	\angle H(j\omega_{0}) = -180^{\circ},
\end{equation}
и називају се Баркхаузеновим критеријумима~\cite{Razavi:PLL_CMOS_2020}. Услов $H(j\omega_{0})=-1$ се назива и услов покретања или почетни услов. \par
Нагомилавање осцилација се такође може посматрати и у временском домену. Са Слике~\ref{osc_feedback_5a} се примјећује да је, са $H(j\omega_{0})=-1$, излаз једнак улазу, али помјерен за $180^{\circ}$. Ако је петља затворена (\figurename~\ref{osc_feedback_5b}), излаз се одузима од улаза, што даје већу амплитуду (замах) на $A$. Тај сигнал се затим поново инвертује и одузима од улаза, и тако у круг, што доводи до неограниченог раста амплитуде (\figurename~\ref{osc_feedback_5c}). \par
%\begin{figure}[!ht]
%	 \centering
%	 \includegraphics[scale=0.65]{slike/osc_feedback_5.png}
%	 \caption{Раст амплитуде улазне синусоиде кроз петљу у току времена.}
%	 \label{osc_feedback_5}
%\end{figure}
\input{slike/osc_feedback_5.tex}
Укратко, систем са негативном повратном спрегом може да генерише растући периодични излаз као одговор на синусоидни улаз ако његово појачање у петљи достигне -1 на коначној фреквенцији, $\omega_{0}$. Али, да ли такав систем осцилује ако не примjенимо никакав улаз? Одговор је да, јер широкопојасни шум уређаја унутар петље има коначну енергију у близини $\omega_{0}$, стварајући малу компоненту која кружи у петљи и изазива осцилације. Нпр. као што је приказано на Слици~\ref{osc_feedback_6}, извор шума, $V_{n}$, на улазу $H(s)$ даје излаз који је једнак:
\begin{equation} 
	\label{osc_feedback_eq_8}
	Y = V_{n}\frac{H(s)}{1+H(s)},
\end{equation}
чиме се доводи до неограниченог појачања за $s=j\omega_{0}$. То такође значи да, чак иако је $V_{n}$ бесконачно мало на $\omega_{0}$, на $Y$ се може претпоставити појављивање неке коначне амплитуде осциловања тј. замаха \engl{Swing}.
%\begin{figure}[!ht]
%	 \centering
%	 \includegraphics[scale=0.8]{slike/osc_feedback_6.png}
%	 \caption{Утицај шума убризганог у систем затворене петље.}
%	 \label{osc_feedback_6}
%\end{figure}
\input{slike/osc_feedback_6.tex}

\subsection{Основе прстенастог осцилатора}
Прстенасти осцилатори су у данашње вријеме веома популарни у \PLL\ системима захваљујући својој прилагодљивости дизајна и широког опсега подешавања фреквенције. Ово поглавље уопштено разматра основе прстенастих осцилатора, да би се стекло дубље разумијевање рада коришћеног дигитално контролисаног осцилатора, чији конкретан дизајн је описан у поглављу~\ref{DCO chapter}. \par
\figurename~\ref{ring_osc_1} приказује основни концепт прстенастог осцилатора са три степена. Ако се користи само један степен, тада се не обезбјеђује довољан фазни помјерај да би важио услов из једначине~\ref{osc_condition_2}. Чак и примјеном два степена, систем не може да осцилује јер $\angle H(j\omega_{0})$ достиже $-180^{\circ}$ тек за $\omega=\infty$~\cite{Razavi:PLL_CMOS_2020}. Због тога се претпоставља да коришћењем три степена могу бити задовољени услови из једначина~\ref{osc_condition_1} и~\ref{osc_condition_2}, па се стога врши даља анализа како би се то и показало. \par 
На Слици~\ref{ring_osc_1}, коло означено испрекиданом линијом је означено са $-H(s)$ да би било у складу са системом негативне повратне спреге приказаним на Слици~\ref{osc_feedback_2}. \par
%\begin{figure}[!ht]
%	 \centering
%	 \includegraphics[scale=0.8]{slike/ring_osc_1.png}
%	 \caption{Три степена са заједничким извором у повратној спрези.}
%	 \label{ring_osc_1}
%\end{figure}
\input{slike/ring_osc_1.tex}
%\begin{figure}[!ht]
%	 \centering
%	 \includegraphics[scale=0.2]{slike/ring_osc_3.png}
%	 \caption{Еквивалентно коло једног степена у петљи.}
%	 \label{ring_osc_2}
%\end{figure}
\input{slike/ring_osc_2_new.tex}
На Слици~\ref{ring_osc_2} приказано је еквивалентно коло на нивоу малих сигнала за један степен прстенастог осцилатора приказаног на Слици~\ref{ring_osc_1}. У случају да за тренутак занемаримо капацитивно оптерећење тј. да важи $C_{L}=0$, добија се уобичајена функција одзива појачавача
\begin{equation} 
	\label{osc_feedback_eq_9_0_1}
	v_{o} = -K(V_{I} - V_{T})R_{L}v_{i} = -g_{m}R_{D}v_{i}.
\end{equation}
Када су $v_{i}=V_{i}\cos (\omega t)$ и $C_{L}=0$, тада је напон на излазу једнак
\begin{equation} 
	\label{osc_feedback_eq_9_0_2}
	v_{o} = -g_{m}R_{D}V_{i}\cos (\omega t).
\end{equation}
У једначинама~\ref{osc_feedback_eq_9_0_1} и~\ref{osc_feedback_eq_9_0_2}, са $g_{m}$ је означена транскондуктанса NMOS транзистора која представља фактор појачања транзистора. Она је обрнуто сразмјерна отпорности и уопштено за MOSFET је једнака
\begin{equation} 
	\label{osc_feedback_eq_9_1}
	g_{m} = K(V_{I} - V_{T}),
\end{equation}
гдје је $V_{I}=V_{GS}$ тј. напон од гејта до сорса, $V_{T}$ је напон прага, а $K$ је параметар повезан са физичком структуром MOSFET-a и једнак је
\begin{equation} 
	\label{osc_feedback_eq_9_2}
        K = K_{n} \frac{W}{L}.
\end{equation}
Са $W$ је означена ширина гејта, са $L$ његова дужина, док је $K_{n}$ константа повезана са MOSFET карактеристикама као што је дебљина оксида~\cite{AGARWAL:2005foundations}. \par
Ако се сада и кондензатор узме у разматрање, да би се пронашла веза између $v_i$ и $v_o$ за коло са Слике~\ref{ring_osc_2}, потребно је направити импедансни модел кола, а он је приказан на Слици~\ref{ring_osc_3a}. \par
\input{slike/ring_osc_3.tex}
Ефективнa вриједност импедансе оптерећења, $Z_L$ (\figurename~\ref{ring_osc_3b}) дата је са
\begin{equation} 
	\label{osc_feedback_eq_9_0_3}
	Z_L = R_{D} || \dfrac{1}{sC_L}.
\end{equation}
Тада је израз за амплитуду излаза ($V_o$) једнак 
\begin{equation} 
	\label{osc_feedback_eq_9_0_4}
	V_o = -g_{m}Z_{L}V_{i} = -g_{m}\left(R_{D}\,||\,\dfrac{1}{sC_{L}}\right)V_{i}.
\end{equation}
То је еквивалентно са
\begin{equation} 
	\label{osc_feedback_eq_9_0_5}
	\frac{V_o}{V_i} = -g_{m}\left(R_{D}\,||\,\dfrac{1}{sC_{L}}\right).
\end{equation}
Како је једначина~\ref{osc_feedback_eq_9_0_5} изведена за један степен, тада за преносну функцију тростепеног прстена са Слике~\ref{ring_osc_1} важи~\cite{Razavi:PLL_CMOS_2020}
\begin{equation} 
	\label{osc_feedback_eq_9}
	-H(s) = \left[-g_{m}\left(R_{D}\,||\,\frac{1}{sC_{L}}\right)\right]^{3}.
\end{equation}
Ако је $s=j\omega_{0}$, тада једначину~\ref{osc_feedback_eq_9} пишемо као
\begin{equation} 
	\label{osc_feedback_eq_10}
	\displaystyle
	H(j\omega_{0}) = \left[g_{m}\left(R_{D}\|\frac{1}{C_{L}j\omega_{0}}\right)\right]^{3} = \left(\frac{g_{m}R_{D}\displaystyle\frac{1}{C_{L}j\omega_{0}}}{R_{D}+\displaystyle\frac{1}{C_{L}j\omega_{0}}}\right)^{3} = \left(\frac{g_{m}R_{D}}{1+R_{D}C_{L}j\omega_{0}}\right)^{3}.
\end{equation}
Добијени резултат представља комплексни разломак који даље желимо представити у стандардном комплексном облику $z = x + jy$:
\begin{equation} 
	\label{osc_feedback_eq_11}
	\displaystyle
	\begin{split}
		H(j\omega_{0}) &= \left(\frac{g_{m}R_{D}}{1+R_{D}C_{L}j\omega_{0}}\cdot\frac{1-R_{D}C_{L}j\omega_{0}}{1-R_{D}C_{L}j\omega_{0}}\right)^{3} = \\
			       &= \left(\frac{g_{m}R_{D}-g_{m}R_{D}^{2}C_{L}j\omega_{0}}{1+R_{D}^{2}C_{L}^{2}\omega_{0}^{2}}\right)^{3} = \\
			       &= \left(\frac{g_{m}R_{D}}{1+R_{D}^{2}C_{L}^{2}\omega_{0}^2}-j\frac{g_{m}R_{D}^{2}C_{L}\omega_{0}}{1+R_{D}^{2}C_{L}^{2}\omega_{0}^{2}}\right)^{3}.
	\end{split}
\end{equation}
Да би се поставио услов $|H(j\omega_{0})|=1$, потребно је наћи модул (интензитет) степеноване вриједности комплексног израза добијеног изнад. Рецимо да имамо неки комплексан број $z=x+jy$. Он се може представити и у поларном облику као
\begin{equation}
	\label{compl_1}
	z = A(\text{cos}\theta + j\text{sin}\theta),
\end{equation}
гдје су:
\begin{itemize}
	\item $A = |z| \rightarrow$ модул (апсолутна вриједност) комплексног броја,
	\item $\theta = \text{arg}(z) = \displaystyle \text{arctan}\left(\frac{y}{x}\right) \rightarrow$ фазни угао (аргумент).
\end{itemize}
Коришћењем Ојлерове формуле, $e^{j\theta} = \text{cos}\theta + j\text{sin}\theta$, комплексни број можемо представити као
\begin{equation}
	\label{compl_2}
	z = Ae^{j\theta}.
\end{equation}
Ако тако представљен комплексни број степенујемо неким природним бројем $n$, добија се
\begin{equation}
	\label{compl_3}
	z^{n} = \left(Ae^{j\theta}\right)^{n} = A^{n}\left(e^{j\theta}\right)^{n} = A^{n}e^{jn\theta}.
\end{equation}
То значи да степеновањем комплексног броја важи следеће:
\begin{enumerate}
	\item Модул комплексног броја се подиже на исти степен.
	\item Фазни угао се множи са вриједношћу степена.
\end{enumerate}
Ако се први закључак примијени на наш случај, важи следеће:
\begin{equation} 
	\label{osc_feedback_eq_12}
	\displaystyle
	\begin{split}
		|H(j\omega_{0})| &= \left|\frac{g_{m}R_{D}}{1+R_{D}^{2}C_{L}^{2}\omega_{0}^2}-j\frac{g_{m}R_{D}^{2}C_{L}\omega_{0}}{1+R_{D}^{2}C_{L}^{2}\omega_{0}^{2}}\right|^{3} = \\
				 &= \left(\sqrt{\frac{g_{m}^{2}R_{D}^{2}}{(1+R_{D}^{2}C_{L}^{2}\omega_{0}^{2})^{2}}+\frac{g_{m}^{2}R_{D}^{4}C_{L}^{2}\omega_{0}^{2}}{(1+R_{D}^{2}C_{L}^{2}\omega_{0}^{2})^{2}}}\right)^{3} = \\
				 &= \left(\sqrt{\frac{g_{m}^{2}R_{D}^{2}(1+R_{D}^{2}C_{L}^{2}\omega_{0}^{2})}{(1+R_{D}^{2}C_{L}^{2}\omega_{0}^{2})^{2}}}\right)^{3} = \\
				 &= \left(\frac{g_{m}R_{D}}{\sqrt{1+R_{D}^{2}C_{L}^{2}\omega_{0}^{2}}}\right)^{3}.
	\end{split}
\end{equation}
На основу претходног израза, услов $|H(j\omega_{0})|=1$ се може представити као
\begin{equation}
	\label{osc_feedback_eq_13}
	\displaystyle
	\left(\frac{g_{m}R_{D}}{\sqrt{1+R_{D}^{2}C_{L}^{2}\omega_{0}^{2}}}\right)^{3} = 1.
\end{equation}
Одатле се може изразити $\omega_{0}$ на следећи начин:
\begin{equation}
	\label{osc_feedback_eq_14}
	\displaystyle
	\omega_{0} = \frac{\sqrt{g_{m}^{2}R_{D}^{2}-1}}{R_{D}C_{L}}.
\end{equation}
Ако сада други закључак примјенимо на фазни угао преносне функције, тада ће $\angle H(j\omega_{0})$ бити једнак
\begin{equation}
	\label{osc_feedback_eq_15}
	\displaystyle
	\begin{split}
		\angle H(j\omega_{0}) &= 3\cdot\text{arctan}\left(\frac{\displaystyle -\frac{g_{m}R_{D}^{2}C_{L}\omega_{0}}{1+R_{D}^{2}C_{L}^{2}\omega_{0}^2}}{\displaystyle \frac{g_{m}R_{D}}{1+R_{D}^{2}C_{L}^{2}\omega_{0}^2}}\right) = \\
				     &= 3\cdot\text{arctan}(-R_{D}C_{L}\omega_{0}) = \\
				     &= -3\cdot\text{arctan}(R_{D}C_{L}\omega_{0}).
	\end{split}
\end{equation}
На основу претходног израза, услов $\angle H(j\omega_{0}) = -180^{\circ}$ може се представити као
\begin{equation}
	\label{osc_feedback_eq_16}
	\displaystyle
	\text{arctan}(R_{D}C_{L}\omega_{0}) = 60^{\circ}.
\end{equation}
Одатле се може представити $\omega_{0}$ на следећи начин:
\begin{equation}
	\label{osc_feedback_eq_17}
	\displaystyle
	\omega_{0} = \frac{\sqrt{3}}{R_{D}C_{L}}.
\end{equation}
Ако сада изједначимо изразе~\ref{osc_feedback_eq_14}~и~\ref{osc_feedback_eq_17}, добија се:
\begin{equation}
	\label{osc_feedback_eq_18}
	\displaystyle
	\frac{\sqrt{g_{m}^{2}R_{D}^{2}-1}}{R_{D}C_{L}} = \frac{\sqrt{3}}{R_{D}C_{L}}.
\end{equation}
Одатле се даље добија:
\begin{equation}
	\label{osc_feedback_eq_19}
	\displaystyle
	g_{m}R_{D} = 2.
\end{equation}
Другим ријечима, сваки степен мора обезбједити појачање напона ниске фреквенције од 2, да бе се гарантовало осциловање~\cite{Razavi:PLL_CMOS_2020}. \par
У општем случају, ако се уведе $N$ идентичних степени у прстен, гдје је $N$ непаран број, петља обезбјеђује негативну повратну спрегу на ниским фреквенцијама, што захтјева фазни помјерај од $-180^{\circ}/N$ по једном степену да би систем осциловао. Тада ће $\omega_{0}$ бити једнако
\begin{equation}
	\label{osc_feedback_eq_20}
	\displaystyle
	\omega_{0} = \frac{1}{R_{D}C_{L}}\text{tan}\frac{180^{\circ}}{N}.
\end{equation}
Како се $N$ повећава, $\omega_{0}$ опада јер свака фаза мора унијети мање фазног помјераја. Такође, у општем случају, како $N$ расте, захтијевано нискофреквентно појачање се смањује што се може видјети из израза
\begin{equation}
	\label{osc_feedback_eq_21}
	\displaystyle
	g_{m}R_{D} = \sqrt{\text{tan}^{2}\frac{180^{\circ}}{N}+1}.
\end{equation}
Видјели смо да су таласни облици прстенастог осцилаотра блиски синусоиди за $|H(j\omega_{0})|=1$. Meђутим, они почињу да личе на квадратни талас ако је $|H(j\omega_{0})|$ знатно изнад 1. Већина апликација тежи оштријим прелазима сигнала како би се осигурало брзо укључивање и искључивање уређаја. Стога су квадратни таласни облици пожељнији за примјену, и у те сврхе се уводи инверторски прстен обрађен у наредном поглављу.

\subsubsection{Инверторски прстен}
Најчешћа имплементација прстенастих осцилатора је коришћењем CMOS инвертора умјесто отпорнички оптерећених појачавача као фаза појачања у прстену. \figurename~\ref{inv_ring_osc_1} приказује тростепени инверторски прстен. Ако претпоставимо да је у почетку $V_{X} = V_{Y} = V_{Z}$, свака фаза уводи напонско појачање од $-(g_{mN}+g_{mP})(r_{ON}||r_{OP})$, које типично има вриједност преко 2~\cite{Razavi:PLL_CMOS_2020}. Након тога, шум унутар компоненти узрокује обнављање сигнала све док амплитуда осциловања не достигне пун напонски опсег \engl{Rail-to-Rail}. \par
%\begin{figure}[!ht]
%	 \centering
%	 \includegraphics[scale=0.4]{slike/inv_ring_osc_1.png}
%	 \caption{Тростепени прстенасти осцилатор састављен од CMOS инвертора.}
%	 \label{inv_ring_osc_1}
%\end{figure}
\input{slike/inv_ring_osc_1.tex}
Шта ако, након укључења, прстен почиње са једним чвором на нули? Рецимо, ако је $V_{X}=0$, тада је $V_{Y}=V_\text{DD}$, а $V_{Z}=0$, што значи да трећи инвертор подиже $V_{X}$ на $V_\text{DD}$. \figurename~\ref{inv_ring_osc_2} приказује идеализоване облике сигнала на сва три степена у прстену, у току времена. Закључујемо да прелаз на једном чвору узрокује прелаз на наредном након одређеног кашњења, $T_{D}$. Укупан период осциловања је стога једнак $6T_{D}$, па је фреквенција осциловања једнака $f=1/6T_{D}$.\par
%\begin{figure}[!ht]
%	 \centering
%	 \includegraphics[scale=0.4]{slike/inv_ring_osc_2.png}
%	 \caption{Облици сигнала на чворовима.}
%	 \label{inv_ring_osc_2}
%\end{figure}
\input{slike/inv_ring_osc_2.tex}
Стварни облици сигнала претходног осцилатора нису тако оштри као на Слици~\ref{inv_ring_osc_2}, али нису ни правилни као синусоида. Реалнији примјер је илустрован на Слици~\ref{inv_ring_osc_3a}, гдје $V_{X}$ мијења правац чим достигне $V_\text{DD}$ или 0, због кратког кашњења кроз петљу. Поређења ради, петостепени прстен омогућава осцилације са периодом $10T_{D}$, дозвољавајући сигналу на $V_{X}$ да дуже времена остане на високом, односно ниском напонском нивоу (\figurename~\ref{inv_ring_osc_3b}). \par
%\begin{figure}[!ht]
%	 \centering
%	 \includegraphics[scale=0.3]{slike/inv_ring_osc_3.png}
%	 \caption{Реалан облик сигнала (а) тростепеног и (б) петостепеног прстенастог осцилатора.}
%	 \label{inv_ring_osc_3}
%\end{figure}
\input{slike/inv_ring_osc_3.tex}
Прстенасти осцилатори су уопштено прилично осјетљиви на вриједности напона напајања. Прво, максимална фреквенција осциловања расте како расте напон напајања. Друго, динамичка потрошња снаге прстенастог осцилатора има чак квадратну зависност од вриједности напона напајања, о чему ће више ријечи бити у поглављу~\ref{DCO chapter}.

\subsection{Шум у осцилаторима} \label{section:osc:noise}
За идеалан осцилатор који ради на фреквенцији $\omega_{c}$, сва његова снага је концентрисана на једну фреквенцију, $\omega_{c}$, као што је приказано на Слици~\ref{fig:osc:noise_1a}. У реалном осцилатору, спектар се шири на околне фреквенције око $\omega_{c}$ (\figurename~\ref{fig:osc:noise_1b}). У осцилаторима се такво ширење назива фазни шум. \par
%\begin{figure}[!ht]
%	 \centering
%	 \includegraphics[scale=0.6]{slike/osc_noise_1.png}
%	 \caption{Излазни спектар (а) идеалног и (б) реалног осцилатора.}
%	 \label{fig:osc:noise_1}
%\end{figure}
\input{slike/osc_noise_1.tex}
Фазни шум се обично карактерише у фреквенцијском домену. За идеалан осцилатор који ради на фреквенцији $\omega_{c}$, излазни напон може бити изражен као
\begin{equation}
	\label{eq:osc:noise:vt_1}
	v(t) = A\cos(\omega_{c}t + \phi),
\end{equation}
гдје је $A$ амплитуда, а $\phi$ је произвољна, али фиксна референтна фаза. Снага је концентрисана на једну фреквенцију $\omega_{c}$. Еквивалентно, спектар снаге се може записати као
\begin{equation}
	\label{eq:osc:noise:sv_1}
	S_{v}(\omega) = \frac{A^{2}}{2}\delta (\omega - \omega_{c}),
\end{equation}
гдје је $\delta$ јединични имплус или Диракова делта функција (\figurename~\ref{fig:osc:noise_1a}). Међутим, у реалном осцилатору и амплитуда и фаза су временски промјенљиве, и спектар ће се зато ширити око фреквенције носиоца на околне фреквенције. У већини случајева, поремећај у амплитуди је занемарљив или неважан, а и може се лако уклонити додавањем кола која ограничавају амплитуду~\cite{Staszewski:FREQUENCY_SYNTHESIZER_CMOS_2005}. Стога се разматра само насумично одступање фазе:
\begin{equation}
	\label{eq:osc:noise:vt_2}
	v(t) = A\cos[\omega_{c}t + \phi (t)],
\end{equation}
гдје је $\phi (t)$ мало насумично одступање фазе које представља варијације у периоду и најчешће се назива фазни шум. За мале вриједности варијација фазног шума, $|\phi (t)| \ll 1\,\text{rad}$, једначина~\ref{eq:osc:noise:vt_2} се може поједноставити на
\begin{equation}
	\label{eq:osc:noise:vt_3}
	v(t) = A\cos\omega_{c}t + A\phi (t)\sin\omega_{c}(t),
\end{equation}
што значи да се спектар $\phi (t)$ фреквенцијски преводи у $\pm \omega_{c}$. \par
Фазни шум се може квантификовати узимањем опсега од 1\,Hz на растојању $\Delta\omega$ од носиоца, затим рачунањем снаге шума у том опсегу и дијељењем тог резултата са снагом носиоца~\cite{Staszewski:FREQUENCY_SYNTHESIZER_CMOS_2005}. То се назива једнострани \engl{single-sided} фазни шум и изражава се у јединици децибела по херцу [dBc/Hz]. По конвенцији, „c“ у „dBc“ значи „у односу на носилац“.
\begin{equation}
	\label{eq:osc:noise:L_1}
	\mathcal{L} (\Delta\omega) = 10\log_{10} \left(\frac{\text{снага шума у опсегу од 1\,Hz при фреквенцији } w_{c}+\Delta\omega}{\text{снага носиоца}}\right)
\end{equation}
Једнострани фазни шум из једначине~\ref{eq:osc:noise:L_1} је половина спектра фазног шума, тј. може се записати као
\begin{equation}
	\label{eq:osc:noise:L_2}
	\mathcal{L} (\Delta\omega) = 10\log_{10} \left(\frac{S_{\phi}(\Delta\omega)}{\text{2}}\right),
\end{equation}
гдје је $S_{\phi}(\Delta\omega)$ дато са
\begin{equation}
	\label{eq:osc:noise:S_phi_1}
	S_{\phi}(\Delta\omega) = \frac{S_{v}(\Delta\omega)}{\text{снага носиоца}}.
\end{equation}
Типични спектар фазног шума осцилатора приказан је на Слици~\ref{fig:osc:noise_2}. У овом логаритамском дијаграму, фазни шум нормализован на dBc/Hz, приказан је у односу на офсет фреквенцију $\Delta\omega$ од носиоца $\omega_{c}$. \par 
%\begin{figure}[!ht]
%	 \centering
%	 \includegraphics[scale=0.7]{slike/osc_noise_2.png}
%	 \caption{Спектар фазног шума реалног осцилатора.}
%	 \label{fig:osc:noise_2}
%\end{figure}
\input{slike/osc_noise_2.tex}
Профил фазног шума прати криву приказану на слици, гдје пролази кроз области са нагибима од $1/\omega^{3}$, $1/\omega^{2}$ и $1/\omega^{0}$. Област $1/\omega^{2}$ се уопштено назива област топлотног шума \engl{Thermal Noise Region} зато што је изазвана тзв. бијелим или неповезаним временским флуктуацијама унутар периода осциловања. Шум треперења \engl{Flicker Noise} $1/f$ електронских уређаја је такође значајан за ниже офсетне фреквенције. Он се конвертује навише у $1/\omega^{3}$ област. Коначно, $1/\omega^{0}$ је топлотни електронски шум који се додаје изван осцилатора, као нпр. у излазном баферу, и не утиче на временски одзив осцилатора. 

\section{Дигитално контролисани осцилатор} \label{DCO chapter}
Дигитално контролисани осцилатор описан у овом раду је прстенасти осцилатор, погодан за систем генерисања такта. Прстенасти осцилатор је каскадна комбинација фаза кашњења повезаних у ланац затворене петље~\cite{Madhusudhana:283751064}. Прстенасте архитектуре су компактније од LC осцилатора и имају доста предности захваљујући својој правилној и периодичној просторној структури. Уопштена структура \DCO-а коришћеног унутар описаног \FLL-а заснована је на матрици тростатичких CMOS инвертора~\cite{Terosiet:340277809}. Ова матрица је састављена од $N$-фазних прстена тростатичких инвертора повезаних паралелно. $N$ представља број \DCO\ фаза (степени) и мора бити непаран број већи или једнак 3.~\figurename~\ref{fig:dco:general} приказује примјер $N$-степеног дигитално контролисаног осцилатора који има један прстен стално укључених инвертора (најдоњи прстен без стрелице управљачког сигнала са доње стране инвертора). \par
%\begin{figure}[!ht]
%	 \centering
%	 \includegraphics[scale=0.25]{slike/dco_1.png}
%	 \caption{$N$-степени дигитално контролисано осцилатор.}
%	 \label{dco_1}
%\end{figure}
\input{slike/dco_general.tex}
%(за осцилатор са једним излазним сигналом у односу на заједничко уземљење)
У физичком смислу, матрица може бити преобликована у квадрат, што омогућава једноставнију управљачку логику. На Слици~\ref{fig:dco:general}, основну фреквенцију \DCO-а дефинише само један прстен који је стално укључен, а у општем случају их може бити више. Остали тростатички инвертори се укључују и искључују у зависности од управљачке логике. \par
Формула за фреквенцију осциловања \DCO-a гласи:
\begin{equation} \label{f_osc}
    f_\text{osc} = \dfrac{1}{2Nt_\text{d}} \approx \dfrac{I_\text{d}}{2NC_\text{load}V_\text{DDL}},
\end{equation} \\
гдје је $N$ број тростатичких инвертора унутар прстена, $t_\text{d}$ представља кашњење једне ћелије \DCO-a, у чијем саставу је тростатички инвертор (у наставку ће бити детаљније објашњена структура саме ћелије \DCO-а), $I_\text{d}$ је струја која протиче кроз инвертор, $C_\text{load}$ је капацитивно оптерећење истог инвертора, и $V_\text{DDL}$ је напон напајања \DCO-а. Производ $Nt_\text{d}$ је помножен са $2$ да би се добила читава периода такта, а не полупериода. \par
Када је ријеч о топологији, са повећањем броја \DCO\ фаза (степени), фреквенцијски корак ($K_\text{DCO}$) опада, чиме се повећава прецизност \DCO-а. Максимална фреквенција осцилатора се се такође смањује, и да би се то надомјестило, напон напајања се може повећати, што с друге стране доводи до веће потрошње снаге. Ако претпоставимо да напон напајања и капацитивно оптерећење по једној фази остану непромјењени, повећање броја фаза не утиче на потрошњу снаге. Међутим, ако укупан број тростатичких инвертора остане непромјењен и подијели се на већи број фаза, то ће довести до смањења капацитивног оптерећења по фазама појединачно, што даље доводи до смањења потрошње снаге. Математичком анализом се то може објаснити на следећи начин: $N$-фазни прстенасти осцилатор који ради на фреквенцији $f_\text{osc}$ има динамичку потрошњу снаге која се може представити једначином
\begin{equation} 
	\label{eq:dco:dynamic_pwr_1}
    	P = N f_\text{osc} C_\text{tot} V^{2}_\text{DDL}, 
\end{equation}
гдје $C_\text{tot}$ представља укупно капацитивно оптерећење на једној фази. Пошто је фреквенција осциловања једнака $f_\text{osc} = 1/(2Nt_\text{d})$, једначину за динамичку снагу можемо написати на следећи начин:
\begin{equation}
    	P = \frac{C_\text{tot}V^{2}_\text{DDL}}{2t_\text{d}},
\end{equation}
одакле се види да је добијена динамичка снага независна од $N$~\cite{Razavi:PLL_CMOS_2020}. \par
С обзиром да је одређени број тростатичких инвертора увијек укључен, \DCO\ има одређену почетну фреквенцију која не зависи од управљачке ријечи \DCO-а. Тренутна излазна фреквенција ће стога у основи зависити од почетне фреквенције, фреквенцијског корака тј. резолуције и управљачке ријечи. Стога се може написати следећа линеарна зависност фреквенције осциловања, која може послужити за софтверску имплементацију рада \DCO-а~\text{\cite{Milovanovic:8190103}}:  
\begin{equation} \label{f_dco}
	f_\text{DCO} = f_\text{0} + K_\text{DCO} \cdot d,
\end{equation} 
гдје је $f_\text{0}$ почетна фреквенција, $K_\text{DCO}$ резолуција фреквенције, а $d$ је управљачка дигитална ријеч.

\subsection{Архитектура предложеног \DCO-a}
У овом раду описана је топологија \DCO-a са пет фаза, због тога што је таквом топологијом остварен задовољавајући компромис између учинка и потрошње снаге тј. под задовољавајућим условима се достиже жељена фреквенција са довољном прецизношћу. \figurename~\ref{DCO5} приказује структуру \DCO-а коришћеног у описаној \FLL\ имплементацији. \par
\input{slike/DCO.tex}
Свака фаза \DCO-а састоји се од 54 тростатичка инвертора, што ако помножимо са бројем фаза даје укупно 270 инвертора. Тростатички инвертори су распоређени у 18 редова и 15 колона. Управљачка логика \FLL-a управља са 17 редова и свих 15 колона, што значи да постоји 255 фреквенцијских корака. Преостали ред са 3$\times$5 тростатичких инвертора је стално укључен и на њега не утиче управљачка логика \FLL-а. Што се више тростатичких инвертора у свакој фази укључи под утицајем управљачке логике \FLL-а, повећавају се струја и тренутна снага покретања \engl{Driving Strength} једне фазе, док њено капацитивно оптерећење у суштини остаје константно, што резултује повећањем излазне фреквенције осциловања~\cite{Tierno:4443210}. Поред самих тростатичких инвертора, на Слици~\ref{DCO5} се могу уочити и блокови претварача напонког нивоа на управљачким улазима и фазама \DCO-a, чија је намјена детаљно објашњена у поглављу~\ref{LS chapter}.

\subsection{Блок дијаграм ћелије \DCO-a}
Да би се ефикасно подесила излазна фреквенција \DCO-а, уведен је скуп управљачких улаза \DCO-а, а то су сигнали \textit{Row On}, \textit{Row Select} и \textit{Column Select}, поменути такође у поглављу~\ref{section:control_decoder}. Према томе, сваки тростатички инвертор садржи сопствену управљачку јединицу у облику И-ИЛИ стандардне ћелије, и заједно граде већи блок назван ћелија \DCO-а. \figurename~\ref{DCO_cell} приказује шему ћелије \DCO-а на нивоу логичких кола и на нивоу CMOS транзистора. Уочава се да И-ИЛИ коло и тростатички инвертор имају заједнички инвертор како би се уштедило на броју транзистора. \par
\input{slike/DCO_cell.tex}
У дигиталном домену сигнал Out може имати три стања. Једно је недефинисано, када је тростатички инвертор искључен. А друга два су када је тростатички инвертор укључен и представљају инвертован сигнал In. Укључивање и искључивање тростатичког инвертора контролише ctrl сигнал који представља излаз из контролног дијела \DCO\ ћелије тј. И-ИЛИ блока стандардне ћелије. За вриједност ctrl сигнала 1, тростатички инвертор је укључен, а за вриједност 0 је искључен. \tablename~\ref{ctrl_truth_table} је таблица истинитости управљачког сигнала ctrl. Логички израз за сигнал ctrl у зависности од управљачких сигнала редова и колона гласи:
\begin{equation}
	\label{dco_cell_ctrl_eq}
	% \text{ctrl} = \overline{(\text{Row Sel.} \cdot \text{Col. Sel.}) + \text{Row On}}
	\text{ctrl} = (\text{Row Sel.} \cdot \text{Col. Sel.}) + \text{Row On}
\end{equation}
\tablename~\ref{out_truth_table} приказује табелу истинитости Out сигнала у зависности од управљачког сигнала ctrl и улазног In. \par
\vspace{0.5cm}
\begin{table}[!ht]
	\caption{Таблица истинитости контролног сигнала тростатичког инвертора.}
	\label{ctrl_truth_table}
	\centering
	\begin{tabular}{|c|c|c||c|}
		\hline
		Row On & Row Sel. & Col. Sel. & ctrl \\
		\specialrule{1pt}{0pt}{0pt}
		0 & 0 & 0 & 0 \\
		\hline
		0 & 0 & 1 & 0 \\
		\hline
		0 & 1 & 0 & 0 \\
		\hline
		0 & 1 & 1 & 1 \\
		\hline
		1 & 0 & 0 & 1 \\
		\hline
		1 & 0 & 1 & 1 \\
		\hline
		1 & 1 & 0 & 1 \\
		\hline
		1 & 1 & 1 & 1 \\
		\hline
	\end{tabular}
\end{table}
\begin{table}[!ht]
	\caption{Таблица истинитости излазног сигнала тростатичког инвертора.}
	\label{out_truth_table}
	\centering
	\begin{tabular}{|c|c||c|}
		\hline
		ctrl & In & Out \\
		\specialrule{1pt}{0pt}{0pt}
		0 & 0 & X \\
		\hline
		0 & 1 & X \\
		\hline
		1 & 0 & 1 \\
		\hline
		1 & 1 & 0 \\
		\hline
	\end{tabular}
\end{table}

\subsection{Претварачи напонског нивоа \DCO-a} \label{LS chapter}
Напон напајања који користи дигитално контролисани осцилатор ($V_\text{DDL}$) се у овом раду разликује од напона напајања који користи остатак логике \FLL-а ($V_\text{DD}$). Предност таквог дизајна је могућност подешавања напона напајања \DCO-а независно након производње чипа, што даље омогућава накнадно постизање жељене резолуције фреквенције (фреквенцијског корака) и фреквенцијског опсега зависно од процесног угла у коме се одвијала производња чипа. Додатна предност јесте и то што могућност смањења напона напајања \DCO-а аутоматски доводи и до значајног смањења потрошње због њене квадратне зависности од напона напајања.
Такав независан домен напајања \DCO-а постигнут је додавањем претварача напонског нивоа на улазе и излазе \DCO-а, као што је и приказано на Слици~\ref{DCO5}. \par
\input{slike/Level_shifters.tex}
Како је напон напајања \DCO-а нижи од остатка система, на управљачке улазе \DCO-a постављени су претварачи са високог на низак напонски ниво \engl[HLLS]{High-Low Level Shifter}, док су на фазне излазе \DCO-a постављени претварачи са ниског на висок напонски ниво \engl[LHLS]{Low-High Level Shifter}. \figurename~\ref{Level_shifters} приказује шеме конвенционалних претварача напонског нивоа који су коришћени у претходно описаном систему. Као што се може видјети са Слике \ref{HL_level_shifter}, претварач са високог на низак напонски ниво није ништа друго до обичан бафер састављен од два инвертора чије напајање ће у коначној реализацији долазити од линије ниског напонског нивоа ($V_\text{DDL}$). \figurename~\ref{LH_level_shifter} приказује шему претварача са ниског на висок напонски ниво, представља регенеративно логичко коло засновано на позитивној повратној спрези~\cite{Osaki:6198744} и састоји се од два унакрсно спрегнута PMOS транзистора (MP1 и MP2) и од NMOS транзистора (MN1 и MN2), који се покрећу преко комплементарних улазних сигнала INL и $\overline{\mbox{INL}}$, гдје је за инвертовање сигнала потребно додати инвертор. \par
С обзиром да је претварач са ниског на висок напонски ниво нешто комплекснији, његов рад ће бити детаљније објашњен. Када напони сигнала INL и $\overline{\mbox{INL}}$ имају вриједност 0 и $V_\text{DDL}$, тада ће MN1 и MN2, редом, бити искључен и укључен. MN2 затим повлачи на нулу напон чвора OUTH, укључујући тако MP1. Тада се и напон чвора $\overline{\mbox{OUTH}}$ подиже на $V_\text{DD}$, MP2 се искључује, а напон на чвору OUTH остаје на нули. С друге стране ако су вриједности напона на INL и $\overline{\mbox{INL}}$ једнаки $V_\text{DDL}$ и 0, тада ће MN1 и MN2 бити укључен и искључен, респективно. MN1 тада повлачи на нулу напон чвора $\overline{\mbox{OUTH}}$, укључујући тако MP2, чиме се напон OUTH подиже на $V_\text{DD}$, а MP1 се искључује. \par
Треба запазити да је напон чвора OUTH одређен покретачком струјом \engl{Drive Current} транзисторa MP2 и MN2, тј. струјом која тече кроз канал транзистора када су укључени. Зато, ако је покретачка струја кроз транзистор MP2 много већа него кроз MN2, тада OUTH не може бити испражњен што доводи до тога да претварач не може исправно радити у таквим ситуацијама~\cite{Osaki:6198744}. До њих иначе може доћи ако је разлика између $V_\text{DD}$ и $V_\text{DDL}$ превелика, што у примјени из овог рада није случај. \par
Претварачи напонских нивоа могу утицати на фактор испуњености импулса тј. периоде такта \engl{Duty Cycle}, поготово на излазу претварача са ниског на висок напонски ниво. Међутим, то се углавном може избјећи додатним баферовањем излаза \DCO-а тј. физичким уметањем одговарајућих бафера између фазног излаза \DCO-a и претварача напонског нивоа чиме се фактор испуњености импулса такта може приближити идеалној вредности од 50\,\%, како би такав дошао на улаз претварача са ниског на висок напонски ниво.


\section{Имплементација и резултати симулација} \label{Implementation and results}
У овом поглављу биће приказана имплементација система кроз анализу SystemVerilog кода и хијерархијским приказом лејаута комплетног \FLL-a. Затим ће бити приказани резултати симулација у различитим условима након екстракције паразитних капацитивности. Такође ће бити приказани резултати софтверског модела рада \FLL-a, а биће направљено и поређење два \DCO-а имплементирана у 2 различите технологије. Дигитални \FLL\ описан у овом раду, имплементиран је коришћењем SystemVerilog језика за опис хардвера у 130\,nm CMOS технологији. Улазни референтни такт је 16\,MHz, док се такт \DCO-a подешава до 640\,MHz, при чему је резолуција учестаности око 2,8\,MHz у типичним условима рада. 

\subsection{SystemVerilog код} \label{section:impl:systemVerilog}
У овом поглављу биће приказани најбитнији дијелови имплементације \FLL-а на нивоу SystemVerilog~\cite{SystemVerilog:1800-2023} језика за опис хардвера. Уз поједине дијелове кода ће бити објашњења у сврху лакшег разумијевања. \lstlistingname~\ref{lst:sv:fll_input} приказује улазе и излазе \FLL-a, који су побројани и у поглављу~\ref{FLL structure}, са додатим сигналима за подешавање управљачке логике. \par 
\begin{lstlisting}[language=Verilog, caption={Улазни и излазни сигнали хијерархијски највишег \FLL\ модула.}, label={lst:sv:fll_input}]
 // Frequency-locked loop
module fll #(
  parameter integer CW = 8  // frequency control word width
)(
  /////////////////////
  // Clock and reset //
  /////////////////////
  input           clk_ref_i,       // [0] reference clock @ 32MHz
  input           clk_ref_en_i,    // [1] reference clock enable signal
                                   //     0: reference clock propagation disabled
                                   //     1: reference clock propagation enabled
  input           rst_ni,          // [0] async reset
                                   //     0: active/asserted
                                   //     1: inactive/deasserted
  /////////
  // FLL //
  /////////
  input  [CW-1:0] clk_mult_i,      // [0d20] reference frequency multiplier (or frequency control word)
                                   //        20 * 32MHz = 640MHz
  /////////
  // DCO //
  /////////
  input           dco_pwr_sel_i,   // [1]     DCO clock output power supply selection
                                   //         0: FLL uses DCO clock output @ VDDL (~1.1V,     adjustable)
                                   //         1: FLL uses DCO clock output @ VDD  (~1.2V, non-adjustable)
  input     [1:0] dco_ctrl_mode_i, // [1]     DCO control mode
                                   //         0d0: FIXED     - DCO control word is internally set to 0d203
                                   //         0d1: MANUAL    - DCO control word is set via "dco_ctrl_man_i" register
                                   //         0d2: BANG-BANG - DCO control word is set by a comparator and a counter
                                   //         0d3: PID       - DCO control word is PID regulated
  input  [CW-1:0] dco_ctrl_man_i,  // [0d200] DCO control word value for MANUAL mode
                                   //         In simulation in typical conditions, a value around 0d200 achieved 640MHz,
                                   //         a value of 0 achieved ~42MHz and a value of 0d255 achieved ~764MHz
  /////////
  // PID //
  /////////
  input  [CW-1:0] pid_kp_i,        // [0b01000000] PID controller proportional constant
                                   //              A signed number in Q6.2 format (0b010000_00 == 0d16)
  input  [CW-1:0] pid_ki_i,        // [0b01000000] PID controller integral constant
                                   //              A signed number in Q6.2 format (0b010000_00 == 0d16)
  input  [CW-1:0] pid_kd_i,        // [0]          PID controller derivative constant
                                   //              A signed number in Q6.2 format
  /////////
  // FLL //
  /////////
  input     [3:0] lock_cnt_i,      // [0b1000] FLL internal counter lock condition threshold
  output          lock_o,          // [0]      FLL lock signal - indicates if FLL achieved the target frequency
                                   //          0: the FLL did not its target frequency yet
                                   //          1: the FLL achieved its target frequency
  ////////////////
  // OSC output //
  ////////////////
  output        clk_dco_o          // DCO clock - one phase
);
...
endmodule
\end{lstlisting}
У поглављу~\ref{section:control_preprocessing} описана је улога и начин рада управљачке предобраде, а~\lstlistingname~\ref{lst:sv:cnt_gray} приказује хардверску имплементацију Грејевог бројача и начин како се генеришу узастопне вриједности бројача. Као што се из кода може видјети, оне се генеришу из наредне природне бинарне вриједности тако што се најстарији бит задржава, док су остали битови резултат бит по бит ексклузивно ИЛИ \engl{XOR} операције између свих битова осим најмлађег и свих битова осим најстаријег (линија \prog{22} у Листингу~\ref{lst:sv:cnt_gray}). Рецимо ако је наредна природна вриједност бројача 5 (бинарно 00000101, ако је ширина бројача 8), да би се претворила у Грејев код, задржава се најстарији бит, тј. 0, а осталих седам се додаје као резултат поменуте ексклузивно ИЛИ операције, тј. 0000010\,\^\,0000101, што даје вриједност 0000111 коју треба додати на 0, чиме се добија вриједност 00000111, која, ако погледамо Табелу~\ref{gray_code}, одговара природној вриједности 5. \par
\begin{lstlisting}[language=Verilog, caption={Модул Грејевог бројача.}, label={lst:sv:cnt_gray}]
module cnt_gray #(
  parameter int  W   = 8,
  parameter byte Val = W'(0)
)(
  input          clk_i,
  input          rst_ni,
  input          en_i,
  output [W-1:0] cnt_gray_o
);

  logic [W-1:0] cnt_bin;
  logic [W-1:0] cnt_bin_next;
  logic [W-1:0] cnt_gray;
  assign cnt_bin_next = cnt_bin + W'(1);
  always_ff @(posedge clk_i or negedge rst_ni) begin
    if (!rst_ni) begin
      cnt_bin <= Val;
      cnt_gray <= {Val[W-1], Val[W-1:1] ^ Val[W-2:0]};
    end else begin
      if (en_i) begin
        cnt_bin <= cnt_bin_next;
        cnt_gray <= {cnt_bin_next[W-1], cnt_bin_next[W-1:1] ^ cnt_bin_next[W-2:0]};
      end else begin
        cnt_bin <= Val;
        cnt_gray <= {Val[W-1], Val[W-1:1] ^ Val[W-2:0]};
      end
    end
  end
  assign cnt_gray_o = cnt_gray;

endmodule
\end{lstlisting}
Добијена вриједност у Грејевом коду се синхронизује кроз два флип флопа и претвара се у природну бинарну вриједност, а имплементација тога је унутар \prog{fll} модула и дата је у~\lstlistingname{у}~\ref{lst:sv:fll_sync_gray_to_bin}. Узоркована вриједност Грејевог бројача је на магистрали \prog{cnt\_dco\_gray\_q2}, док је природна бинарна вриједност на магистрали \prog{cnt\_dco} и она суштински представља тренутни умножак фреквенције добијене на излазу \DCO-a, и представља податак спреман за поређење са жељеним умношком са улаза, унутар блока управљачке логике. Сваки бит у тој магистали се добија као резултат логичке XOR операције над свим битовима Грејевог записа, помјереног онолико мјеста удесно колико износи тежина тренутног бита у \prog{cnt\_dco} магистрали (имплементација на линији \prog{7} у \lstlistingname{у}~\ref{lst:sv:fll_sync_gray_to_bin}). \par
\begin{lstlisting}[language=Verilog, caption={Претварање Грејевог кода у природну бинарну вриједност.}, label={lst:sv:fll_sync_gray_to_bin}]
module fll #(
  ...
  // Gray to binary conversion
  genvar i;
  generate
    for(i=0; i<CW; i++) begin: gen_gray2bin_conv
       assign cnt_dco[i] = ^(cnt_dco_gray_q2 >> i);
    end: gen_gray2bin_conv
  endgenerate
  ...
endmodule
\end{lstlisting}
Двостепени контролер, као један дио управљачке логике, је подробније објашњен у поглављу~\ref{section:bang_bang}. Као што је тамо напоменуто, састоји се од компаратора и једног бројача. Компаратор служи за поређење добијеног и жељеног умношка фреквенције, а резултат се шаље у бројач који на основи њега одређује како подесити управљачку ријеч за \DCO. \lstlistingname~\ref{lst:sv:bang_bang:comparator} приказује компараторски дио који се налази унутар \prog{fll} модула. Као што се може закључити, \prog{cnt\_dco\_q} представља семпловану вриједност тренутног умношка, односно вриједност \prog{cnt\_dco} из \lstlistingname{a}~\ref{lst:sv:fll_sync_gray_to_bin}. Сигнал \prog{cnt\_ref\_up\_dn} одређује да ли инкрементирати или декрементирати управљачку ријеч \DCO-а, док сигнал \prog{cnt\_ref\_en} одређује да ли уопште мијењати вриједност бројача (сигнал \prog{lock\_o} ће бити поменут при анализи имплементације \PID\ контолера). Закључује се да се поменути сигнали прослјеђују даље у блок бројача, чија је имплементација, као посебног \prog{cnt} модула, приказана у \lstlistingname{у}~\ref{lst:sv:bang_bang:cnt}. Сигнали \prog{cnt\_ref\_up\_dn} и \prog{cnt\_ref\_en} се при инстанцирању \prog{cnt} модула прослијеђују на његове \prog{up\_down\_i} и \prog{en\_i} улазе, респективно. \par
\begin{lstlisting}[language=Verilog, caption={Компараторски дио двостепеног контролера.}, label={lst:sv:bang_bang:comparator}]
module fll #(
  ...
  // Comparator
  logic  cnt_ref_up_dn;
  logic  cnt_ref_en;
  assign cnt_ref_up_dn = (clk_mult_i >= cnt_dco_q) ?    1'b1 : 1'b0;
  assign cnt_ref_en    = (clk_mult_i != cnt_dco_q) ? ~lock_o : 1'b0;
  ...
endmodule
\end{lstlisting}
\begin{lstlisting}[language=Verilog, caption={Имплементација бројача из двостепеног контролера.}, label={lst:sv:bang_bang:cnt}]
// Up-down counter with enable
module cnt #(
  parameter int  W   = 8,     // count width (number of bits)
  parameter byte Val = W'(0)  // counter default value
) (
  // Clock and reset
  input                clk_i,     // clock
  input                rst_ni,    // async reset
  // Control
  input                en_i,      // enables counting
  input                up_down_i, // count direction
  // Count data output
  output logic [W-1:0] cnt_o      // count output
);

always_ff @(posedge clk_i or negedge rst_ni) begin
  if (!rst_ni) begin
    cnt_o <= Val;
  end else begin
    if (en_i) begin
      if (up_down_i == 1'b1) begin
        cnt_o <= W'(cnt_o + W'(1));
      end else begin
        cnt_o <= W'(cnt_o - W'(1));
      end
    end else begin
      cnt_o <= cnt_o;
    end
  end
end

endmodule
\end{lstlisting}
Имплементација \PID\ контролера, детаљније објашњеног у поглављу~\ref{section:pid}, приказана је у \lstlistingname{у}~\ref{lst:sv:pid}, гдје се види да је имплементиран као посебан \prog{pid} модул. Поред улаза такта, ресета и коефицијената контролера, ту су још улази:
\begin{itemize}
	\item \prog{setpoint\_i} који представља жељени умножак фреквенције (при инстанцирању модула прослјеђује му се вриједност \prog{clk\_mult\_i} са улаза \prog{fll} модула),
	\item \prog{feedback\_i} који представља семпловани тренутни умножак (при инстанцирању модула прослјеђује му се семплована вриједност \prog{cnt\_dco} из \lstlistingname{a}~\ref{lst:sv:fll_sync_gray_to_bin}) и
	\item \prog{lock\_cnt\_i} који означава колико узлазних ивица такта грешка мора бити једнака нули да би се достигло закључавање, односно да би се излазни сигнал \prog{lock\_o} подигао на 1.
\end{itemize}
Излаз \prog{ctrl\_o} представља податак који ће да служи као управљачка ријеч за DCO (аналогно излазу \prog{cnt\_o} из \prog{cnt} модула двостепеног контролера). Он означава 8-битну цјелобројну вриједност и добија се издвајањем 8 бита од позиције 13 до позиције 6 из промјенљиве \prog{ctrl\_pid} (линија \prog{64} у \lstlistingname{у}~\ref{lst:sv:pid}) у којој је смјештена сума пропорционалног, интегралног и диференцијалног дејства. Такво издвајање битова је резултат коришћења бинарног бројевног система са фиксном тачком, о коме се више може наћи у литератури~\cite{Harris:DIGITAL_DESIGN_2012}, а све то у сврху повећања резолуције подешавања \PID\ контролера. Наиме, улазни коефицијенти \prog{kp\_i}, \prog{ki\_i} и \prog{kd\_i} су 8-битни у формату Q6.2 (6 бита за цјелобројни дио, 2 за децимални дио), док је формат \prog{ctrl\_pid} промјенљиве Q12.6 (12 битова за цјелобројни дио, 6 за децимални дио), па се поменутим одсијецањем врши заокруживање на 8-битни цијели број. \par
\begin{lstlisting}[language=Verilog, caption={Имплементација \PID\ контролера.}, label={lst:sv:pid}]
// PID controller
module pid #(
  parameter int DW = 8,  // data input width
  parameter int CW = 8   // control output width
) (
  input                 clk_i,
  input                 rst_ni,
  input        [DW-1:0] kp_i,
  input        [DW-1:0] ki_i,
  input        [DW-1:0] kd_i,
  input        [DW-1:0] setpoint_i,
  input        [DW-1:0] feedback_i,
  input        [3:0]    lock_cnt_i,
  output logic [CW-1:0] ctrl_o,
  output logic          lock_o
);

  // Localparam
  localparam int ErrCntW = 4;

  // Error logic
  logic signed [DW-1:0] err;
  logic signed [DW-1:0] err_prev;
  logic signed [DW-1:0] err_diff;
  assign err = setpoint_i - feedback_i;
  assign err_diff = err - err_prev;
  logic [ErrCntW-1:0] err_eq0_cnt;
  logic [ErrCntW-1:0] err_cnt_lock;
  assign err_cnt_lock = ErrCntW'(lock_cnt_i);
  always_ff @(posedge clk_i or negedge rst_ni) begin
    if (!rst_ni) begin
      err_eq0_cnt   <= '0;
    end else begin
      if ((err == '0) && (err_eq0_cnt < err_cnt_lock)) begin
        err_eq0_cnt <= err_eq0_cnt + ErrCntW'(1);
      end
    end
  end

  // PID calculation & lock
  logic signed [CW+DW-1:0] prop;
  logic signed [CW+DW  :0] integ;
  logic signed [CW+DW-1:0] deriv;
  logic signed [CW+DW+1:0] ctrl_pid;
  always_ff @(posedge clk_i or negedge rst_ni) begin
    if (!rst_ni) begin
      prop     <= '0;
      integ    <= '0;
      deriv    <= '0;
      err_prev <= '0;
      ctrl_pid <= '0;
      lock_o   <= '0;
    end else begin
      prop     <= (kp_i * err);
      integ    <= integ + (ki_i * err);
      deriv    <= (kd_i * err_diff);
      err_prev <= err;
      if ((err == '0) && (err_eq0_cnt == err_cnt_lock) && (err_cnt_lock != '0)) begin
        lock_o <= 1'b1;
      end
      ctrl_pid <= lock_o ? ctrl_pid : 18'(prop) + integ + 18'(deriv);
    end
  end
  assign ctrl_o = ctrl_pid[13:6];

endmodule
\end{lstlisting}
Излази \prog{cnt\_o} и \prog{ctrl\_o} из двостепеног и \PID\ контролера, редом, представљају суштински број тростатичких инвертора \DCO-а који требају бити укључени, што утиче на његову излазну фреквенцију. Међутим, та вриједност се не прослјеђује директно у модул \DCO-a, већ се преко управљачког декодера анализираног у поглављу~\ref{section:control_decoder} претвара у скуп одговарајућих векторских улаза за управљање \DCO-ом тј. редовима и колонама тростатичких инвертора унутар њега. Тај поступак претварања је приказан у \lstlistingname{у}~\ref{lst:sv:control_decoder}, а имплементиран је у оквиру \prog{fll} модула. \par
\begin{lstlisting}[language=Verilog, caption={Имплементација управљачког декодера из поглавља~\ref{section:control_decoder}.}, label={lst:sv:control_decoder}]
module fll #(
  ...
  // Convert digital code to real DCO inputs (row/col sel and row on)
  localparam int NumRows = 17;
  localparam int NumCols = 15;
  logic [NumRows-1:0] row_on_d;
  logic [NumRows-1:0] row_sel_d;
  logic [NumCols-1:0] col_sel_d;
  always_comb begin
      row_on_d  = '0;
      row_sel_d = '0;
      col_sel_d = '0;
      for(int r = 1; r <= NumRows; r = r + 1) begin
        // Row on logic
        if (int'(dco_ctrl) > r*NumCols) begin
          row_on_d[r-1] = 1'b1;
        end else begin
          row_on_d[r-1] = 1'b0;
        end
        // Row & column select logic
        if ((int'(dco_ctrl) > (r-1)*NumCols) && (int'(dco_ctrl) <= r*NumCols)) begin
          for(int c = 0; c < NumCols; c = c + 1) begin
            if ((r-1)*NumCols + c < int'(dco_ctrl)) begin
              col_sel_d[c] = 1'b1;
            end else begin
              col_sel_d[c] = 1'b0;
            end
          end
          row_sel_d[r-1] = 1'b1;
        end else begin
          row_sel_d[r-1] = 1'b0;
        end
      end
  end
  ...
endmodule
\end{lstlisting}
Сигнали \prog{row\_on\_d}, \prog{row\_sel\_d} и \prog{col\_sel\_d} се синхронизују на одговарајући такт и прослјеђују се као улази у \DCO\ модул који је имплементиран као посебан блок у алатима за аналогно пројектовање, па стога овдје нема свој опис у SystemVerilog-у, већ се тај блок само инстанцира унутар \prog{fll} модула, као што је приказано у \lstlistingname{у}~\ref{lst:sv:dco_inst}. Као што се може видјети, \prog{dco} модул садржи излазе за свих 5 фаза на ниском ($V_\text{DDL}$) и високом ($V_\text{DD}$) напонском нивоу, а који од та два напонска нивоа ће се наћи на \prog{clk\_dco\_o} излазу \prog{fll} модула одређује његов улазни сигнал \prog{dco\_pwr\_sel\_i} (погледати \lstlistingname~\ref{lst:sv:fll_input}). \par 
\begin{lstlisting}[language=Verilog, caption={Инстанцирање \DCO\ блока.}, label={lst:sv:dco_inst}]
module fll #(
  ...
  // DCO model
  logic clk_dco_ph0;
  logic clk_dco_ph0_l;
  logic clk_dco_ph0_h;
  logic clk_dco_ph1;
  logic clk_dco_ph1_l;
  logic clk_dco_ph1_h;
  logic clk_dco_ph2;
  logic clk_dco_ph2_l;
  logic clk_dco_ph2_h;
  dco u_dco(
    .ROW_ON    (row_on),
    .ROW_SEL   (row_sel),
    .COLUMN_SEL(col_sel),
    .PH0       (clk_dco_ph0_h),
    .PH0_L     (clk_dco_ph0_l),
    .PH1       (clk_dco_ph1_h),
    .PH1_L     (clk_dco_ph1_l),
    .PH2       (clk_dco_ph2_h),
    .PH2_L     (clk_dco_ph2_l),
    .PH3       (),
    .PH3_L     (),
    .PH4       (),
    .PH4_L     ()
  );
  assign clk_dco_ph0 = dco_pwr_sel_i ? clk_dco_ph0_h : clk_dco_ph0_l;
  assign clk_dco_ph1 = dco_pwr_sel_i ? clk_dco_ph1_h : clk_dco_ph1_l;
  assign clk_dco_ph2 = dco_pwr_sel_i ? clk_dco_ph2_h : clk_dco_ph2_l;
  assign clk_dco_o = clk_dco_ph2;
  ...
endmodule
\end{lstlisting}

\subsection{Лејаут}
За израду лејаута намјенски је коришћена 7Т \engl{7-Track} библиотака стандардних ћелија, гдје 7Т означава да висина свих ћелија тачно толике висине да може да се вертикално провуче 7 линија метала минималне ширине и са минималним размаком. То доприноси лакшем аутоматском (а и ручном) рутирању и слагању ћелија у компактну цјелину у сврху оптималне искористивости простора. Лејаут коначне верзије цјелокупног \FLL-а приказан је на Слици~\ref{layout_FLL}. Читав дизајн \FLL-a заузима 33000\,\text\textmu m$^\text2$. Компонента у доњем десном углу је дигитално контролисани осцилатор, док остатак лејаута углавном припада управљачкој логици \FLL-a. \par
\begin{figure}[!ht]
	 \centering
	 \begin{tikzpicture}
	 % The image node
        \node[inner sep=0] (layout_FLL) { \includegraphics[scale=0.37]{slike/layout_FLL.png} };
        \draw[<->] (-7.75,-2.25) -- (-7.7,2.25) node[midway, left=0.2, above=0.05, rotate=90] {\footnotesize 100\,\textmu m};
        \draw[<->] (-7.45,-2.55) -- (7.45,-2.55) node[midway, right=0.1, below=0.02] {\footnotesize 330\,\textmu m};
        \end{tikzpicture}	
	\caption{Лејаут дигиталног \FLL-а, са \DCO-ом у доњем десном углу.}
	\label{layout_FLL}
\end{figure}
\DCO\ је имплементиран као независна компонента коришћењем библиотека стандардних ћелија. Од читавог лејаута \FLL-a, око 13\,\% заузима \DCO, тачније око 4300\,\text\textmu m$^\text2$ (вриједност добијена сабирањем појединачних површина коришћених ћелија). \figurename~\ref{layout_dco5_130} приказује лејаут \DCO-a са претварачима напонских нивоа који се могу уочити са лијеве и горње стране лејаута (претварачи са високог на низак напонски ниво на управљачким улазима \DCO-a), као и са десне стране (претварачи са ниског на висок напонски ниво на свих 5 фаза \DCO-a). \par 
\begin{figure}[!ht]
	 \centering
	 \vspace{-0.3cm}
	 \begin{tikzpicture}
	 % The image node
        \node[inner sep=0] (layout_dco5_130) { \includegraphics[scale=0.15]{slike/layout_dco5_hl_lh_130.png} };
        \draw[<->] (-7.25,-7.3) -- (-7.25,6.8) node[midway, left=0.2, above=0.05, rotate=90] {\footnotesize 70,11\,\textmu m};
        \draw[<->] (-6.73,-7.9) -- (7,-7.9) node[midway, right=0.1, below=0.02] {\footnotesize 67,825\,\textmu m};
        \end{tikzpicture}	
	\caption{Лејаут \DCO-а са претварачима напонских нивоа.}
	\label{layout_dco5_130}
\end{figure}
\figurename~\ref{layout_dco_cell} приказује лејаут једне ћелије \DCO-a. Са десне стране ћелије је оријентисан тростатички инвертор, док је са лијеве стране управљачки И-ИЛИ дио. Површина једне ћелије је око 13,7\,\text\textmu m$^\text2$. \par
%\begin{figure}[!ht]
%	 \centering
%	 \begin{tikzpicture}
%	 % The image node
%        \node[inner sep=0] (layout_dco_cell) { \includegraphics[scale=0.25]{slike/layout_dco_cell.png} };
%        \draw[<->] (-3.5,-3.1) -- (-3.5,2.9) node[midway, left=0.2, above=0.05, rotate=90] {\footnotesize 3.69\,\textmu m};
%        \draw[<->] (-3.0,-3.8) -- (3.0,-3.8) node[midway, right=0.1, below=0.02] {\footnotesize 3.72\,\textmu m};
%        \end{tikzpicture}	
%	\caption{Лејаут ћелије \DCO-а.}
%	\label{layout_dco_cell}
%\end{figure}
Лејаут претварача са високог на низак и са ниског на висок напонски ниво је приказан на Слици~\ref{layout_lvl_hl} и~\ref{layout_lvl_lh}, респективно. Као што је већ напоменуто у поглављу~\ref{LS chapter}, претварач са високог на низак напонски ниво је у суштини бафер и овдје је његова површина око 6,8\,\text\textmu m$^\text2$, док је претварач са ниског на висок напонски ниво нешто сложенији и, ради бољег уклапања тј. заузимања мање површине у комбинацији са \DCO-ом, имплементиран је као ћелија са дуплом висином, што омогућава мању ширину ћелије, а површина јој је око 38,3\,\text\textmu m$^\text2$. \par 
%\begin{figure}[!ht]
%	 \centering
%	 \subfloat[\centering]{
%	 	\begin{tikzpicture}
%	 	% The image node
%        	\node[inner sep=0] (layout_lvl_hl) { \includegraphics[scale=0.27]{slike/layout_lvl_hl.png} };
%        	\draw[<->] (-1.62,-2.16) -- (-1.62,2.05) node[midway, left=0.2, above=0.05, rotate=90] {\footnotesize 3.69\,\textmu m};
%        	\draw[<->] (-1.08,-2.8) -- (1.08,-2.8) node[midway, right=0.1, below=0.02] {\footnotesize 1.84\,\textmu m};
%        	\end{tikzpicture}
%		\label{layout_lvl_hl}}
%	\qquad
%	\hspace{1cm}
%	\subfloat[\centering]{
%	 	\begin{tikzpicture}
%	 	% The image node
%        	\node[inner sep=0] (layout_lvl_lh) { \includegraphics[scale=0.25]{slike/layout_lvl_lh.png} };
%        	\draw[<->] (-3.5,-4.3) -- (-3.5,4.1) node[midway, left=0.2, above=0.05, rotate=90] {\footnotesize 7.38\,\textmu m\,(2$\cdot$3.69\,\textmu m)};
%        	\draw[<->] (-3.1,-4.9) -- (3.1,-4.9) node[midway, right=0.1, below=0.02] {\footnotesize 5.195\,\textmu m};
%        	\end{tikzpicture}
%		\label{layout_lvl_lh}}
%	\caption{Лејаут претварача са (а) високог на низак и (б) ниског на висок напонски ниво.}
%	\label{layout_lvl_hl_lh}
%\end{figure}
\begin{figure}[!ht]
	 \centering
	 \subfloat[\centering]{
	 	\begin{tikzpicture}
	 	% The image node
        	\node[inner sep=0] (layout_dco_cell) { \includegraphics[scale=0.167]{slike/layout_dco_cell.png} };
        	\draw[<->] (-2.3,-2) -- (-2.3,1.9) node[midway, left=0.2, above=0.05, rotate=90] {\footnotesize 3,69\,\textmu m};
        	\draw[<->] (-1.95,-2.6) -- (1.95,-2.6) node[midway, right=0.1, below=0.02] {\footnotesize 3,72\,\textmu m};
        	%\draw[<->] (-3.5,-3.1) -- (-3.5,2.9) node[midway, left=0.2, above=0.05, rotate=90] {\footnotesize 3.69\,\textmu m};
        	%\draw[<->] (-3.0,-3.8) -- (3.0,-3.8) node[midway, right=0.1, below=0.02] {\footnotesize 3.72\,\textmu m};
        	\end{tikzpicture}	
		\label{layout_dco_cell}}
	 \qquad
	 \hspace{-1.3cm}
	 \subfloat[\centering]{
	 	\begin{tikzpicture}
	 	% The image node
        	\node[inner sep=0] (layout_lvl_hl) { \includegraphics[scale=0.25]{slike/layout_lvl_hl.png} };
        	\draw[<->] (-1.3,-2) -- (-1.3,1.9) node[midway, left=0.2, above=0.05, rotate=90] {\footnotesize 3,69\,\textmu m};
        	\draw[<->] (-0.95,-2.6) -- (0.95,-2.6) node[midway, right=0.1, below=0.02] {\footnotesize 1,84\,\textmu m};
        	\end{tikzpicture}
		\label{layout_lvl_hl}}
	\qquad
%	\hspace{1cm}
	\hspace{-1.3cm}
	\subfloat[\centering]{
		%\vspace{0.3cm}
	 	\begin{tikzpicture}
	 	% The image node
        	\node[inner sep=0] (layout_lvl_lh) { \includegraphics[scale=0.23]{slike/layout_lvl_lh.png} };
        	\draw[<->] (-3.05,-4) -- (-3.05,3.8) node[midway, left=0.2, above=0.05, rotate=90] {\footnotesize 7,38\,\textmu m\,(2$\cdot$3,69\,\textmu m)};
        	\draw[<->] (-2.75,-4.55) -- (2.75,-4.55) node[midway, right=0.1, below=0.02] {\footnotesize 5,195\,\textmu m};
        	\end{tikzpicture}
		\label{layout_lvl_lh}}
	\caption{Лејаут (а) ћелије \DCO-а, (б) претварача са високог на низак и (в) претварача са ниског на висок напонски ниво.}
	\label{layout_dco_cell_lvl_hl_lh}
\end{figure}

\subsection{Симулација рада фреквенцијски затворене петље}
Симулација рада \FLL-a у оба управљачка режима приказана је на Слици~\ref{sim_FLL}. Са приказаних графика се може видјети да се у оба управљачка режима достиже стабилно закључавање \FLL-a са излазном фреквенцијом веома блиској траженој фреквенцији, при чему грешка може бити у опсегу просјечне вриједности резолуције \DCO-а (испод 3\,MHz). Међутим, иако се у оба режима исправно достиже жељена фреквенција, између њих постоји разлика у брзини достизања исте. Тако, у \PID\ режиму (\P=15, \I=15, \D=0), закључавање се одвија много брже, и то за 1,83\,\textmu s, док је, поређења ради, за закључавање у режиму са двостепеним контролером потребно 13,13\,\textmu s.
\begin{figure}[!ht]
    \centering
    \subfloat[]{
	    \input{slike/sim_PID.tex}
    }
    %\hfil
    \vspace{0.2cm}
    \subfloat[]{		
	    \hspace{-0.2cm}
	    \input{slike/sim_BB.tex}
    }	
    \caption {Симулација \FLL-а у (а) \PID\ и (б) двостепеном режиму.} % , lock time 1.8\,\textmu s lock time 13.3\,\textmu s
    \label{sim_FLL}
\end{figure}

\subsection{\PVT\ зависност дигитално контролисаног осцилатора} \label{section:impl:pvt}
Да би се одредило понашање \DCO-a у реалним условима, потребно је провјерити понашање \DCO-а при промјени процесних углова, напона напајања и температуре, односно провјерити различите \PVT\ случајеве. У оквиру овог рада симулирано је понашање у три различита \PVT\ случаја:
\begin{enumerate}
	\item Најспорији случај (slow-slow процесни угао, $V_\text{DD}$=1,1\,V, $V_\text{DDL}$=1\,V, 125\,$^{\circ}$C)
	\item Типични случај (typical-typical процесни угао, $V_\text{DD}$=1,2\,V, $V_\text{DDL}$=1,1\,V, 40\,$^{\circ}$C)
	\item Најбржи случај (fast-fast процесни угао, $V_\text{DD}$=1,3\,V, $V_\text{DDL}$=1,2\,V, -40\,$^{\circ}$C)
\end{enumerate}
\figurename~\ref{DCO_worst_typical_best} приказује зависност фреквенције \DCO-a и фреквенцијског корака тј. резолуције фреквенције ($K_\text{DCO}$) од броја укључених тростатичких инвертора (тј. од управљачке ријечи \DCO-a), за најспорији, типичан и најбржи \PVT\ случај. \par
\input{slike/sim_DCO_worst_typical_best.tex}
\tablename~\ref{tab:frequency_ranges_and_average_kdco} приказује фреквенцијски опсег \DCO-а и просјечну вриједност фреквенцијског корака ($K_\text{DCO}$) у три претходно обрађена случаја. Под опсегом се подразумијевају минималне и максималне вриједности фреквенције која се добија на излазу \DCO-а за укључен мининалан (у овом случају 15) и максималан број (у овом случају 255) тростатичких инвертора \DCO-а, респективно.
\begin{table}[!ht]
	\caption{Фреквенцијски опсег \DCO-a и просјечна вриједност фреквенцијског корака ($K_\text{DCO}$).}
	\label{tab:frequency_ranges_and_average_kdco}
	\centering
	\begin{tabular}{|c|c|c|c|}
		\hline
		Случај & $f_{\min}$ & $f_{\max}$ & Просјечан $K_\text{DCO}$ \\
		\specialrule{1pt}{0pt}{0pt}
		Најспорији & 27,2\,MHz & 502\,MHz & 1,8\,MHz \\
		\hline
		Типичнни& 42\,MHz & 764\,MHz & 2,8\,MHz \\
		\hline
		Најбржи & 63,3\,MHz & 1,146\,GHz & 4,2\,MHz \\
		\hline
	\end{tabular}
\end{table}
Иако у најспоријем случају фреквенција не достиже жељених 640\,МHz, oна ипак може бити достигнута повећањем засебног напона напајања осцилатора ($V_\text{DDL}$). Такође је могуће анализирати и зависност фреквенције од свих \PVT\ параметара независно, међутим те зависности нису приказане у раду због временске захтјевности извршавања потребних симулација, као и због већ приказаних резултата симулација у најспоријем, типичном и најбржем случају, који су ипак најбитнији за анализу понашања имплементираног система јер се ослањају на понашање система у граничним условима рада. Ипак, што се тиче понашања \DCO-а у зависности од свих \PVT\ параметара појединачно, потребно је напоменути да се фреквенција повећава са бржим процесним углом, већим напоном напајања, као и мањом температуром. \par
Да би се значајно смањило вријеме потребно за добијање резултата из симулација након екстракције лејаута, и то са минималним губитком прецизности добијених резултата, симулације \DCO-a су извршене на нивоу појединачно екстракованих ћелија \DCO-a и екстракованих претварача напонског нивоа, са додатним паразитним кондензатором на свакој фази \DCO-a. Улога тих кондензатора је да надомјесте паразитне капацитивности које се јављају у потпуно екстракованом лејауту \DCO-a због међусобно повезаних ћелија, а које нису аутоматски урачунате ако се симулације врше на нивоу појединачно екстракованих компоненти \DCO-a, као што је то овде случај. Вриједност капацитивности додатог кондензатора прорачуната је на основу извјештаја генерисаног из екстракције паразитних капацитивности на нивоу читавог дизајна.  

\subsection{Анализа потрошње система} \label{section:impl:dco_pwr}
Потрошња снаге сваког дизајна утиче на велики број критичних одлука при самом пројектовању, као што су одређивање капацитивности извора напајања, трајања батерије, величине линија напајања, начина паковања, захтјева за хлађењем система итд. Значи да је потрошња снаге важна особина дизајна јер значајно утиче на изводљивост примјене крајњег производа, као и на трошкове и поузданост при коришћењу~\cite{RABAEY:2003digital}. \par
Зависно од проблема који се анализира, разматрају се различите мјере потрошње снаге. Рецимо, када се разматра величина линија напајања, тада је битна максимална вриједност снаге \engl{Peak Power}, $P_{peak}$, док при разматрању захтјева за хлађењем или складиштењем енергије тј. батеријом, од главног интереса је просјечна потрошња снаге \engl{Average Power Dissipation}~\cite{RABAEY:2003digital}. Те мјере су дефинисане следећим формулама:
\begin{equation}
	\label{eq:impl:dco_pwr:peak}
	P_{peak} = i_{peak}V_{supply} = \max [p(t)]
\end{equation}
\begin{equation}
	\label{eq:impl:dco_pwr:av}
	P_{av} = \frac{1}{T}\int_{0}^{T}p(t)dt = \frac{V_{supply}}{T}\int_{0}^{T}i_{supply}(t)dt
\end{equation}
гдје је $i_{supply}$ струја која долази од извора са напоном $V_{supply}$ у интервалу $t \in [0,T]$, док је $i_{peak}$ максимална вриједност $i_{supply}$ унутар тог интервала. \par
Од горе поменутих, у овом раду је кључна просјечна потрошња снаге. Како је \DCO\ кључни елемент \FLL-a, он је и убједљиво највећи потрошач у систему. Самим тим, његовим изолованим симулацијама се може умногоме предвидјети и потрошња коначног система, што значи да се пројектовање убрзава тиме што није потребно баш увијек радити симулације дизајна читавог \FLL-a како би се приближно одредила потрошња. \par
Све симулације потрошње које слиједе су извршаване за фреквенцију осциловања од 640\,MHz. Након симулације дизајна \DCO-a (са претварачима напонских нивоа) у типичним условима рада, при чему су $V_\text{DD}$=1,2\,V и $V_\text{DDL}$=1,1\,V, добија се вриједност просјечне потрошње од 2,5\,mW од извора напајања $V_\text{DDL}$ одакле се напајају осцилатор, претварачи са високог на низак и једним дијелом претварачи са ниског на висок напонски ниво и 0,22\,mW од извора напајања $V_\text{DD}$ одакле се, у овој симулацији, већим дијелом напајају претварачи са ниског на висок напонски ниво као и излазни бафери (погледати поглавље~\ref{LS chapter}). \par
Потрошња се може утврдити и преко средње квадратне \engl[RMS]{Root Mean Square} вриједности струје која се добија при истим условима и овде износи 2,185\,mA и 0,18\,mA од извора напајања $V_\text{DDL}$ и $V_\text{DD}$, респективно. С обзиром да је средња квадратна вриједност струје величина директно сразмјерна просјечној потрошњи снаге, при анализи потрошње углавном је довољно навести резултате у једној од тих величина. Формула за RMS вриједност потрошње струје неког извора гласи:
%Множењем RMS вриједности струје са напоном напајања добија се приближно поменута вриједност просјечног расипања снаге, па је углавном довољно навести један од та два параметра потрошње.\begin{equation}
\begin{equation}
	\label{eq:impl:dco_pwr:rms_i}
	\text{rms}(i_{supply}) = \sqrt{\frac{1}{T}\int_{0}^{T}i_{supply}^{2}(t)dt}
\end{equation}
% TODO
% Провјерити тврдње изнад
Резултати симулације наведени у претходним параграфу, од читавог \FLL-a, обухватају \DCO\ са претварачима напонских нивоа. Да би се утврдила и потрошња управљачке логике (која се напаја са извора $V_\text{DD}$), под истим условима је покренута и симулација потрошње читавог \FLL-a, гдје се на изворима напајања $V_\text{DDL}$ и $V_\text{DD}$ добијају RMS вриједности потрошње струје 2,185\,mA и 0,9\,mA, респективно. Ако се од укупне RMS вриједности струје са $V_\text{DD}$ извора напајања од 0,9\,mA одузме изнад поменута вриједност коју троше само претварачи са ниског на висок напонски ниво и излазни бафери \DCO-а (0,18\,mA), добије се RMS вриједност потрошње струје управљачке логике \FLL-a и износи 0,72\,mA.

\subsection{Временски одзив дигитално контролисаног осцилатора}
Временски одзив \engl{Timing} односи се на облик сигнала на фазама дигитално контролисаног осцилатора на нивоу једне периоде излазног такта. У сврху приказа временског одзива симулиран је рад екстракованог \DCO-а у типичним условима. \par
\input{slike/sim_DCO_phases.tex}
\figurename~\ref{DCO_phases} приказује генерисани сигнал такта на свакој од пет фаза \DCO-а. Приказани сигнали су добијени са улаза ($V_\text{DDL}$ домен напона напајања) и излаза ($V_\text{DD}$ домен напона напајања) претварача са ниског на висок напонски ниво. Као што је приказано у једначини \ref{f_osc}, фреквенција осциловања $f_\text{osc}$ зависи од $t_\text{d}$ тј. кашњења кроз ћелију \DCO-а која садржи тростатички инвертор. Та вриједност је практично једнака аритметичкој средини кашњења узлазне и силазне ивице сигнала такта ($t_\text{lh}$ и $t_\text{hl}$). Други важан параметар за разматрање је фактор испуњености импулса такта тј. однос времена које излазни сигнал проведе на високом, односно ниском, напону у једној периоди такта и самог периода такта. Изражава се у процентима тј. колико процентуално сигнал такта проведе на високом, а колико на ниском напону тј. нули и идеално је да тај однос буде $50\%-50\%$. \par
Добијене вриједности кашњења узлазне и силазне ивице такта на баферованом излазу претварача са ниског на висок напонски ниво су $t_\text{lh}=26\,\text{ps}$ и $t_\text{hl}=20\,\text{ps}$, респективно. Добијени однос унутар радног циклуса такта је апроксимативно $48\%-52\%$. Временски помјерај између двије сусједне фазе је око $940\,\text{ps}$.

\subsection{Спектар снаге фреквенцијски затворене петље}
Нормализовани спектар снаге предложеног \FLL-а у \PID\ режиму, током процеса одржавања вриједности фреквенције од 640\,MHz на излазу, приказан је на Слици~\ref{FLL_spectrum}. \par
\begin{figure}[!ht]
    \centering
    \includegraphics[scale=1, width=12.8cm, height=10.5cm]{slike/fll_spectrum_ppt.pdf}
    \caption{Спектар снаге \FLL-a, са фреквенцијом носиоца 640\,MHz, најјачим нивоом непожељног сигнала (у средини лијево) на -23,6\,dBc, и највећим непожељним сигналом референтне фреквенције унутар 640 $\pm$ 16\,MHz (горе десно, зумирано) на нивоу -43,8\,dBc.}
    \label{FLL_spectrum}
\end{figure}
Подаци са графика су добијени из дигиталне симулације на нивоу логичких кола, трајања 15\,\textmu m, која укључује идеалан бешумни модел \DCO-а написан у SystemVerilog-у. Излаз симулације је потпуно детерминистички квадратни талас састављен од јединица и нула, одабран са учестаношћу 10\,GHz, и сачуван за даљу обраду.\par
Највећа вриједност на графику представља фреквенцију осциловања \FLL-а, односно фреквенцију носиоца \engl{Carrier Frequency}. Ниво највећег непожељног тона је $-23,6\,\text{dBc}$, што је више од два реда величине испод нивоа фреквенције носиоца ($0\,\text{dBc}$). У зумираној области, може се видјети непожељан сигнал унутар референтне фреквенције и то лијево и десно од носиоца са помјерајем \engl{Offset} од 16\,MHz, чији је најјачи ниво на $-43,8\,\text{dBc}$.

\subsection{Фазни шум дигитално контролисаног осцилатора}
Због насумичних фазних одступања, спектар снаге реалног осцилатора се такође шири на фреквенције око фреквенције носиоца, $f_\text{osc}$. Извори насумичних фазних поремећаја~\cite{Milovanovic:8190103} у виду шума треперења и топлотног шума се манифестују као $1/f^3$ and $1/f^2$ области, респективно, у добијеном профилу фазног шума на Слици~\ref{Phase_noise}. Приказани резултати су добијени у типичним \PVT\ условима, са вриједношћу напона напајања \DCO-a ($V_\text{DDL}$) од 1,1\,V, и вриједности фреквенције носиоца ($f_\text{osc}$) од 640\,MHz.
\input{slike/sim_DCO_phase_noise.tex}

\section{Пајтон модел \FLL-а} \label{section:python_model}
У сврху практичнијег симулирања и бољег предвиђања понашања \FLL-а при различитим условима рада, направљен је основни Пајтон модел цјелокупног \FLL-а. Предност посједовања таквог модела јесте што се одређене карактеристике конкретног дизајна могу параметризовати и затим је, у зависности од тога колико услова модел покрива, могуће веома брзо добити мање или више вјеродостојан резултат понашања тог дизајна, умјесто да се, с друге стране, мијења дизајн и додатним симулацијама утврђују карактеристике под различитим условима, па тек затим пређе на симулације крајњег понашања, што доста успорава процес пројектовања. Конкретна имплементација Пајтон модела \FLL-а из овог рада обухвата, поред параметара самог \FLL-а, и параметризовану почетну фреквенцију \DCO-а и његову резолуцију, што омогућава тренутно добијање резултата симулације. Треба напоменути да направљени модел предвиђа константне услове рада тј. параметри модела се не мијењају током времена, односно кроз итерације у петљи модела, и да модел не покрива све услове рада. То значи да резултати приказани у наставку не морају да одговарају резултатима из RTL симулација или симулација на нивоу логичких кола, већ су ту да пројектанта наведу на исправну употребу одређених константи (као што су \PID\ константе) или да му помогну око одабира компоненти дизајна чије појединачно понашање му је већ познато и може да се параметризује (рецимо понашање \DCO-а). \par

\subsection{Пајтон код} \label{section:python_model:source}
У наставку ће бити приказан изворни Пајтон код модела, са логиком и називима промјенљивих који углавном одговарају онима из SystemVerilog хардверске имплементације. Биће наведени само листинзи, без детаљног објашњења кода, јер је већина принципа рада већ анализирана при опису хардверске имплементације. Прегледности ради, код је подијељен у класе и то:
\begin{itemize}
	\item \prog{fll} - Класа \FLL\ компоненте (\lstlistingname~\ref{lst:py:fll}).
	\item \prog{pid} - Класа \PID\ контролера (\lstlistingname~\ref{lst:py:pid}).
	\item \prog{cnt} - Класа бројача из двостепеног контролера (\lstlistingname~\ref{lst:py:cnt}).
	\item \prog{dco} - Класа дигитално контролисаног осцилатора (\lstlistingname~\ref{lst:py:dco}).
\end{itemize}
С обзиром да \prog{dco} класа нема хардверску имплементацију у виду SystemVerilog модула, треба напоменути да се логика имплементације софтверског модела ослања на једначину~\ref{f_dco} што се може видјети у~\lstlistingname{у}~\ref{lst:py:dco}.
\begin{lstlisting}[language=Python, caption={Имплементација модела \FLL\ компоненте.}, label={lst:py:fll}]
from dco import dco
from cnt import cnt
from pid import pid

class fll:
    def __init__(self,
                 # Inputs from design
                 CW,               # control word width
                 clk_ref_i,        # reference clock
                 clk_ref_en_i,     # reference clock enable
                 rst_ni,           # async reset
                 clk_mult_i,       # reference frequency multiplier [40]
                 dco_pwr_sel_i,    # DCO clock output power supply selection: VDDL/VDD [0/1]
                 dco_ctrl_man_i,   # manual DCO control word [200]
                 dco_ctrl_mode_i,  # DCO control mode: FIXED/MANUAL/CNT/PID [PID=3/CNT=2]
                 pid_kp_i,         # PID controller proportional constant [0b01000000]
                 pid_ki_i,         # PID controller integral constant [0b01000000]
                 pid_kd_i,         # PID controller derivative constant [0]
                 lock_cnt_i,       # FLL lock counter condition [0b1000]
                 # Additional input parameters
                 k_dco,            # DCO frequency resolution
                 clk_dco_init):    # DCO initial frequency (dco_ctrl=0) 
        """
        Frequency-locked loop (FLL) is a negative feedback control system that locks the output frequency signal to the target frequency. Principally, it continuously controls the oscillator frequency in an automated way until its output frequency matches the target value, after which that value is maintained at the output.
        """
        # Inputs from design
        self.CW = CW
        self.clk_ref_i = clk_ref_i 
        self.clk_ref_en_i = clk_ref_en_i
        self.rst_ni = rst_ni
        self.clk_mult_i = clk_mult_i
        self.dco_pwr_sel_i = dco_pwr_sel_i  
        self.dco_ctrl_man_i = dco_ctrl_man_i
        self.dco_ctrl_mode_i = dco_ctrl_mode_i 
        self.pid_kp_i = pid_kp_i
        self.pid_ki_i = pid_ki_i
        self.pid_kd_i = pid_kd_i
        self.lock_cnt_i = lock_cnt_i
        # Additional input parameters
        self.k_dco = k_dco
        self.clk_dco_init = clk_dco_init
        # Component instantiation
        self.dco_inst = dco(k_dco=self.k_dco,
                            init_freq=self.clk_dco_init)
        self.cnt_inst = cnt()
        self.pid_inst = pid(rst_ni=self.rst_ni,
                            kp_i=self.pid_kp_i,
                            ki_i=self.pid_ki_i,
                            kd_i=self.pid_kd_i,
                            setpoint_i=self.clk_mult_i,
                            feedback_i=self.clk_dco_init//self.clk_ref_i,
                            lock_cnt_i=self.lock_cnt_i)
        # Outputs from design
        self.lock_o = self.clk_dco_init//self.clk_ref_i == self.clk_mult_i
        self.clk_dco_o = self.clk_dco_init

    def run(self,
            rst_ni):
        self.rst_ni = rst_ni

        # Convert control mode integer value to the corresponding binary array (1/0 integers) 
        dco_ctrl_mode_bin_arr = list(map(int, list(bin(self.dco_ctrl_mode_i)[2:][::-1])))

        # PID logic
        self.pid_inst.feedback_i = self.clk_dco_o//self.clk_ref_i
        self.pid_inst.run(rst_ni=self.rst_ni)
        dco_ctrl_pid = self.pid_inst.ctrl_o

        # Bang-bang logic
        #cnt_en_i = 1  # used if you want frequency oscillation in the stable state
        cnt_en_i = not self.pid_inst.lock_o if (self.clk_mult_i != self.clk_dco_o//self.clk_ref_i) else 0
        cnt_up_down = 1 if (self.clk_mult_i > self.clk_dco_o//self.clk_ref_i) else 0
        self.cnt_inst.run(rst_ni=self.rst_ni,
                          en_i=cnt_en_i and dco_ctrl_mode_bin_arr[1],
                          up_down_i=cnt_up_down)
        dco_ctrl_cnt = self.cnt_inst.cnt_o

        # Control preprocessing
        dco_ctrl_man = self.dco_ctrl_man_i if (dco_ctrl_mode_bin_arr[0]) else 203
        dco_ctrl_auto = dco_ctrl_pid if (dco_ctrl_mode_bin_arr[0]) else dco_ctrl_cnt
        dco_ctrl = dco_ctrl_auto if (dco_ctrl_mode_bin_arr[1]) else dco_ctrl_man

        # DCO logic
        self.dco_inst.run(ctrl=dco_ctrl)

        # FLL outputs setup
        self.clk_dco_o = int(self.dco_inst.freq_out)
        self.lock_o = self.pid_inst.lock_o
\end{lstlisting}
\begin{lstlisting}[language=Python, caption={Имплементација класе \PID\ контролера.}, label={lst:py:pid}]
import copy

INT_WIDTH = 8                   # width of output control signal
FX_INT_WIDTH = 12               # integer part width of PID sum (Q12.6)
FX_DEC_WIDTH = 6                # decimal part width of PID sum (Q12.6)
CTRL_WIDTH = FX_INT_WIDTH + FX_DEC_WIDTH  # total width of PID sum

class pid:
    def __init__(self,
                 rst_ni,
                 kp_i,
                 ki_i,
                 kd_i,
                 setpoint_i,
                 feedback_i,
                 lock_cnt_i):
        self.rst_ni = rst_ni
        self.kp_i = kp_i
        self.ki_i = ki_i
        self.kd_i = kd_i
        self.setpoint_i = setpoint_i
        self.feedback_i = feedback_i
        self.lock_cnt_i = lock_cnt_i
        self.ctrl_o = 0
        self.lock_o = 0
        self.err_eq0_cnt = 0
        self.integ = 0
        self.err = setpoint_i - feedback_i
        self.err_prev = 0
        self.ctrl_pid = 0

    def run(self,
            rst_ni):
        self.rst_ni = rst_ni

        if (not self.rst_ni):
            self.err_eq0_cnt = 0
        else:
            if ((self.err == 0) and (self.err_eq0_cnt < self.lock_cnt_i)):
                self.err_eq0_cnt += 1

        prop = 0
        deriv = 0
        self.err = self.setpoint_i - self.feedback_i
        err_diff = self.err - self.err_prev

        if (not self.rst_ni):
            prop = 0
            self.integ = 0
            deriv = 0
            self.err_prev = 0
            self.ctrl_pid = 0
            self.lock_o = 0
        else:
            prop = self.kp_i * self.err
            self.integ += self.ki_i * self.err
            deriv = self.kd_i * err_diff
            self.err_prev = copy.deepcopy(self.err)
            if ((self.err == 0) and (self.err_eq0_cnt == self.lock_cnt_i) and (self.lock_cnt_i != 0)):
                self.lock_o = 1
            if (not self.lock_o):
                self.ctrl_pid = prop + self.integ + deriv

        self.ctrl_o = int(format(int(self.ctrl_pid), '0'+str(CTRL_WIDTH)+'b')[FX_INT_WIDTH-INT_WIDTH:FX_INT_WIDTH], 2)
\end{lstlisting}
\begin{lstlisting}[language=Python, caption={Имплементација класе бројача двостепеног контролера.}, label={lst:py:cnt}]
class cnt:
    def __init__(self):
        self.cnt_o = 0
        self.default_val = 0

    def run(self,
            rst_ni,
            en_i,
            up_down_i):
        if (not rst_ni):
            self.cnt_o = self.default_val
        else:    
            if (en_i):
                if (up_down_i):
                    self.cnt_o += 1
                else:
                    self.cnt_o -= 1
        return self.cnt_o
\end{lstlisting}
\begin{lstlisting}[language=Python, caption={Имплементација класе дигитално контролисаног осцилатора.}, label={lst:py:dco}]
class dco:
    def __init__(self,
                 k_dco,
                 init_freq):
        self.k_dco = k_dco
        self.init_freq = init_freq
        self.freq_out = init_freq

    def run(self,
            ctrl):
        self.freq_out = self.init_freq + self.k_dco * ctrl
\end{lstlisting}

\subsection{Поређење рада различитих управљачких режима} \label{section:python_model:pid_vs_cnt}
\figurename~\ref{fig:py:pid_vs_cnt_1} приказује одзив софтверског модела \FLL-а при раду у \PID\ и двостепеном управљачком режиму рада. У конкретној симулацији коришћено је понашање \DCO-а добијено симулацијом у типичним условима рада, па су при инстанцирању софтверског модела \FLL-а коришћени подаци из Табеле~\ref{tab:frequency_ranges_and_average_kdco}, односно $K_\text{DCO}$=2,8\,MHz и $f_\text{min}$=42\,MHz за почетну фреквенцију. Конкретна вриједност фреквенције која се овом симулацијом достиже у оба режима је 641,2\,MHz. У \PID\ режиму модел до те фреквенције стиже након 28 итерација, док му је са двостепеним управљачким режимом потребно 214 итерација. \par 
\input{slike/py_pid_vs_cnt_1.tex}
У поглављу~\ref{section:bang_bang} поменута је појава осциловања фреквенције у стабилном стању када \FLL\ ради у двостепеном режиму. На Слици~\ref{fig:py:pid_vs_cnt_1} те осцилације не постоје, а проблем је ријешен условним довођењем \prog{pid.lock\_o} сигнала на \prog{cnt.en\_i} улаз бројача двостепеног контролера. Логика имплементације се налази на линији \prog{75}~\lstlistingname{а}~\ref{lst:py:fll}. Да би се ипак показало како те осцилације изгледају, довољно је само закоментарисати поменуту линију, а одкоментарисати линију \prog{74}. Тиме се добија одзив као на Слици~\ref{fig:py:pid_vs_cnt_2}, гдје фреквенција у стабилном стању, при коришћењу двостепеног контролера, варира између 638,4\,MHz и 641,2\,MHz (примјећујемо да разлика између поменутих вриједности представља вриједност резолуције, $K_\text{DCO}$=2,8\,MHz).
\input{slike/py_pid_vs_cnt_2.tex}

\subsection{Утицај константи \PID\ контролера на одзив система} \label{section:python_model:pid_tuning}
У овом поглављу биће софтверски симулиран утицај различитих вриједности константи \PID\ контролера на одзив система. Треба напоменути да одзив не мора у потпуности одговарати стварном одзиву система већ му је циљ помоћи при исправном одабиру константи \PID\ контролера, а све у циљу добијања најбржег и најправилнијег одзива система у крајњој имплементацији. Као што је објашњено у поглављу~\ref{section:pid}, диференцијална константа није коришћена у имплементацији, па стога неће бити приказан утицај њених различитих вриједности на одзив система. Слике~\ref{fig:py:pid_kp_tuning} и ~\ref{fig:py:pid_ki_tuning} редом приказују утицај различитих вриједности пропорционалне ($K_\text{p}$) и интегралне ($K_\text{i}$) константе на брзину и начин достизања жељене фреквенције. \par
\input{slike/py_pid_kp_tuning.tex}
\input{slike/py_pid_ki_tuning.tex}
Уочава се да пропорционална константа утиче на осјетљивост и стабилност система, а у општем случају систем може постати нестабилан ако је њена вриједност превелика. С друге стране, повећањем интегралне константе убрзава се кретање излаза ка жељеној вриједности. Треба напоменути да је децимални опсег вриједности константи од 0 до 63,75 јер представљају 8-битне вриједности у формату Q6.2, што је поменуто и у поглављу~\ref{section:impl:systemVerilog}.

\subsection{Утицај резолуције \DCO-а на одзив система} \label{section:python_model:dco_tuning}
Оно што такође знатно може убрзати, а самим тим и олакшати, пројектовање јесте предвиђање одзива система за различите карактеристике \DCO-а. Тако ће у наставку бити приказан одзив за различите вриједности резолуције и то само у двостепеном режиму рада због поједностављења приказа. \figurename~\ref{fig:py:kdco_tuning} приказује одзив за три различите $K_\text{DCO}$ вриједности при почетној фреквенцији од 42\,MHz. У приказу је намјерно подешена верзија модела са осцилацијама у стабилном стању како би се што боље дочарао утицај резолуције на прецизност система. Такође се са графика може примјетити да повећањем резолуције тј. прецизности опада брзина одзива система. 
\input{slike/py_kdco_tuning.tex}

\section{Поређење \DCO-а пројектованих у 130\texorpdfstring{\,}{ }nm и 180\texorpdfstring{\,}{ }nm технологији} \label{section:compare_tech}
С обзиром да скалирање технологије у којој се врши фабрикација значајно утиче на перформансе система, ово поглавље ће бити посвећено поређењу особина два дигитално контролисана осцилатора, једног пројектованог у TSMC 130\,nm технологији (у којој је пројектован читав \FLL\ из овог рада), а другог у TSMC 180\,nm технологији. \par
Како скалирање уређаја значајно смањује минималну величину компоненти CMOS уређаја, тако се и други CMOS параметри, сходно томе, повећавају или смањују, а све у циљу постизања бољих перформанси. Главни параметри који утичу на перформансе CMOS-а су: дебљина оксида $t_\text{ox}$, укупна капацитивност гејта $C_\text{g}$ и укупна отпорност гејта $R_\text{g}$, a утицај скалирања на њихове вриједности и даље на перформансе је детаљно описан у литератури~\cite{HASSAN2006275}. \par
Уопштено, ознаке 180\,nm на 130\,nm односе се на дужину полисилицијумског гејта MOSFET-а, што значи да се скалирањем технологије дужина гејта смањује и тиме транзистори постају мањи. То омогућава већу густину транзистора на истом чипу и тиме долази до смањења укупне површине интегрисаног кола. Мањи транзистори омогућавају интеграцију више функција на истом чипу, чиме се смањује укупна површина потребна за реализацију исте функционалности. \figurename~\ref{fig:compare_tech:layout:dco5} приказује конкретно утицај скалирања технологије на површину потребну за реализацију петостепеног \DCO-а са укупно 255 ћелија. Мјере са слике се односе на дужине и ширине без претварача напонских нивоа (који се налазе са лијеве, десне и горње стране у оба лејаута) како би се добило мјеродавније поређење. Површина која је била потребна за реализацију лејаута \DCO-a у 130\,nm и 180\,nm технологији износи око 3700\,\text\textmu m$^\text2$ и 6000\,\text\textmu m$^\text2$, респективно. То значи да је скоро 40\,\% мања површина потребна за реализацију у 130\,nm. \par
\begin{figure}[!ht]
	 \centering
	 \subfloat[\centering]{
		\vspace{0.25cm}
	 	\begin{tikzpicture}
	 	% The image node
        	\node[inner sep=0] (layout_dco5_130_tech) { \includegraphics[scale=0.05]{slike/layout_dco5_hl_lh_130.png} };
        	\draw[<->] (-2.5,-2.45) -- (-2.5,2.03) node[midway, left=0.2, above=0.05, rotate=90] {\footnotesize 66,42\,\textmu m};
        	\draw[<->] (-1.97,-2.8) -- (1.8,-2.8) node[midway, right=0.1, below=0.02] {\footnotesize 55,8\,\textmu m};
        	\end{tikzpicture}
		\label{fig:compare_tech:layout:dco5_130}}
	\qquad
	\hspace{-0.55cm}
	\subfloat[\centering]{
	 	\begin{tikzpicture}
	 	% The image node
        	\node[inner sep=0] (layout_dco5_180_tech) { \includegraphics[width=8.8cm, height=6.18cm]{slike/layout_dco5_hl_lh_180.png} };
        	\draw[<->] (-4.3,-2.45) -- (-4.3,2.315) node[midway, left=0.2, above=0.05, rotate=90] {\footnotesize 70,557\,\textmu m};
        	\draw[<->] (-3.25,-3.1) -- (2.55,-3.1) node[midway, right=0.1, below=0.02] {\footnotesize 85,34\,\textmu m};
        	\end{tikzpicture}
		\label{fig:compare_tech:layout:dco5_180}}
	\caption{Лејаут \DCO-а пројектованог у TSMC (а) 130\,nm и (б) 180\,nm технологији.}
	\label{fig:compare_tech:layout:dco5}
\end{figure}
Слакирање транзистора обично долази са смањењем напона напајања, јер мањи транзистори могу радити на нижим напонима. То смањење напона смањује динамичку потрошњу, која је пропорционална квадрату напона напајања: 
\begin{equation}
	\label{eq:compare_tech:dyn_pwr}
	P_{dyn} = C_{L}V_{supply}^{2}f.
\end{equation}
Такође, смањење капацитивног оптерећења смањује динамичку потрошњу. У нашем случају извршене су симулације при раду на фреквенцији 640\,MHz у типичним условима рада са вриједностима $V_\text{DD}$=1,2\,V и $V_\text{DDL}$=1,1\,V за \DCO\ у 130\,nm и $V_\text{DD}$=1,8\,V и $V_\text{DDL}$=1,6\,V за \DCO\ у 180\,nm. Средње квадратне (RMS) вриједности потрошње струје и просјечна потрошња снаге на тим линијама напајања, за оба осцилатора, дати су у Tабели~\ref{tab:compare_tech:pwr}. Из резултата се види да је просјечна потрошња снаге мања за чак око 50\,\% (долази до изражаја квадратна зависност од напона напајања), a RMS вриједности струје за око 30\,\% за \DCO\ пројектован у 130\,nm. \par
\begin{table}[!ht]
	\caption{Поређење RMS вриједности потрошње струје и просјечне снаге \DCO-a пројектованих у 130\,nm и 180\,nm.}
	\label{tab:compare_tech:pwr}
	\centering
	\begin{tabular}{|c||c|c|}
		\hline
	         & 130\,nm & 180\,nm \\
		\specialrule{1.5pt}{0pt}{0pt}
		$\text{rms}(i_\text{DDL})$ & 2,185\,mA & 3,105\,mA \\
		\hline
		$\text{rms}(i_\text{DD})$ & 0,18\,mA & 0,27\,mA \\
		\hline
		Укупно rms($i$) & 2,365\,mA & 3,375\,mA \\
		\specialrule{1.5pt}{0pt}{0pt}
		$P_{av}(V_\text{DDL})$ & 2,5\,mW & 5,0\,mW \\
		\hline
		$P_{av}(V_\text{DD})$ & 0,22\,mW & 0,5\,mW \\
		\hline
		Укупно $P_{av}$ & 2,72\,mW & 5,5\,mW \\
		\hline
	\end{tabular}
\end{table}
Додатна предност скалирања је што мањи транзистори могу радити на вишим фреквенцијама, што повећава укупне перформансе чипа. Разлог је то што скалирање транзистора доводи до смањења кашњења при пребацивању са 0 на 1 и обрнуто. Кашњење је сразмјерно отпорности и капацитивности гејта, а обје поменуте величине су директно пропорционалне димензијама гејта које се смањују скалирањем технологије. То значи да ће осцилатор у напреднијој технологији (у овом случају 130\,nm) бити у могућности да синтетише сигнал са већим фреквенцијама, за исти напон напајања. \tablename~\ref{tab:compare_tech:freq} приказује разултате симулација при различитим условима рада и вриједностима напона напајања. Подешавање параметара који одређују услове рада приказани су у Табели~\ref{tab:compare_tech:freq:cond}. \par 
\begin{table}[!ht]
	\caption{Подешавање услова рада за симулације опсега фреквенције.}
	\label{tab:compare_tech:freq:cond}
	\centering
	\begin{tabular}{|c|c||c|c|c|c|}
		\hline
		Случај & Технологија & Процесни угао & Температура & $V_\text{DD}$ & $V_\text{DDL}$ \\
		\specialrule{1.5pt}{0pt}{0pt}
		Најспорији & 130\,nm & slow-slow & 125$^{\circ}\,C$ & 1,1\,V & 1,0\,V \\
		\hline
		Типични & 130\,nm & typical-typical & 40$^{\circ}\,C$ & 1,2\,V & 1,1\,V \\
		\hline
		Најбржи & 130\,nm & fast-fast & -40$^{\circ}$\,C & 1,3\,V & 1,2\,V \\
		\specialrule{1.5pt}{0pt}{0pt}
		Најспорији & 180\,nm & slow-slow & 125$^{\circ}$\,C & 1,6\,V & 1,4\,V \\
		\hline
		Типични & 180\,nm & typical-typical & 40$^{\circ}$\,C & 1,8\,V & 1,6\,V \\
		\hline
		Најбржи & 180\,nm & fast-fast & -40$^{\circ}$\,C & 2,0\,V & 1,8\,V \\
		\hline
	\end{tabular}
\end{table}
\begin{table}[!ht]
	\caption{Поређење опсега фреквенција при различитим условима рада за \DCO\ пројектован у 130\,nm и 180\,nm.}
	\label{tab:compare_tech:freq}
	\centering
	\begin{tabular}{|c|c||c|c|}
		\hline
		Случај & Технологија & $f_\text{min}$ & $f_\text{max}$ \\
		\specialrule{1.5pt}{0pt}{0pt}
		Најспорији & 130\,nm & 27,2\,MHz & 502\,MHz \\
		\hline
		Типични & 130\,nm & 42\,MHz & 764\,MHz \\
		\hline
		Најбржи & 130\,nm & 63,3\,MHz & 1,146\,GHz \\
		\specialrule{1.5pt}{0pt}{0pt}
		Најспорији & 180\,nm & 23,06\,MHz & 421,4\,MHz \\
		\hline
		Типични & 180\,nm & 40\,MHz & 726\,MHz \\
		\hline
		Најбржи & 180\,nm & 64,43\,MHz & 1,168\,GHz \\
		\hline
	\end{tabular}
\end{table}
Из резултата се види да се слакирањем технологије значајно може смањити напон напајања да би се добио жељени опсег фреквенције, што наравно значи да се уз много мању потрошњу постижу сличне, или чак боље, перформансе у раду \DCO-а. \par
\subsection{Начин и утицај коришћења дубоке јаме N типа у аналогном пројектовању \DCO-а}
Дитално контролисани осцилатор пројектован у 180\,nm TSMC технологији, поред стандардних јама \engl{Well} P и N типа, посједује додатну тзв. дубоку јаму N типа \engl[DNW]{Deep N-Well}. Да би се показало чему она служи, потребно је анализирати појаве које се дешавају у слојевима у које су сами транзистори уроњени. Приликом рада транзистора појављује се шум у подлози \engl{Substrate Noise} који се дешава због убризгавања наелектрисања у подлогу и јаме. Тај проблем се рјешава употребом n$+$ и p$+$ спојева \engl{Tap} повезаних редом на $V_\text{DD}$ и $V_\text{SS}$, за PMOS и NMOS транзисторе, респективно (\figurename~\ref{fig:dnw:typical}). Додатни проблем је што постоји капацитивно спрезање између N јаме и P подлоге, што значи да више шума долази до извора. У дигиталним колима то обично није проблем због прилично високе отпорности логичких кола на шум. Међутим, у аналогном пројектовању, шум може бити озбиљан проблем па се користе различите технике за његово сузбијање као што су додавање заштитних прстенова \engl{Guard Ring} или коришћење одвојеног напајања за спојеве у подлози и јамама. Треба поменути да заштитни прстенови не могу спријечити појаву шума дубоко у подлози~\cite{DNW:aspencore}. Други проблем је што NMOS транзистори обично нису изоловани од подлоге. У основној CMOS изради, NMOS транзистор је уроњен у P подлогу \engl{P-Substrate} повезану на масу, док је PMOS уроњен у N јаму \engl{N-Well} повезану на напајање, као што је приказано на Слици~\ref{fig:dnw:typical}. \par
\input{slike/dnw_1.tex}
Изолација NMOS транзистора се може постићи коришћењем поменуте дубоке јаме N типа. Она се формира уметањем високоенергетске јонске имплантације непосредно прије формирања стандардне јаме N типа~\cite{DNW:1503847}. Повезивање дубоке јаме N типа врши се преко стандардне јаме N типа која је окружује и повезана је на напајање, $V_\text{DD}$. Тако се, стварањем изоловане јаме P типа \engl{P-Well}, изолује NMOS транзистор. Како додатном изолацијом глобална P подлога остаје без p$+$ споја који је неопходан да се појавом шума у подлози не наруше перформансе уређаја, додаје се заштитни прстен који се повезује на $V_\text{SS}$. \figurename~\ref{fig:dnw:dnw_cmos} приказује начин изолације NMOS транзистора преко дубоке јаме N типа уз додати заштитни прстен. \par
\input{slike/dnw_2.tex}
Како NMOS и PMOS транзистори обично иду у пару приликом CMOS пројектовања, да би се боље искористио простор тј. смањила површина крајњег лејаута, за повезивање дубоке јаме N типа се може искористити стандардна јама N типа коју користи PMOS транзистор, а заштитни прстен се помјера да обухвати читав дизајн, што је приказано на Слици~\ref{fig:dnw:dnw_cmos_compact}. У конкретном дизајну \DCO-a, са Слике~\ref{fig:compare_tech:layout:dco5_180} се може уочити заштитни прстен који обухвата читав \DCO. \par
\input{slike/dnw_3.tex}
Дакле, дубока јама N типа има улогу у смањењу шума у подлози и омогућава потпуно изоловање NMOS транзистора, који, теоретски, након тога могу бити на потенцијалу различитом од масе~\cite{DNW:aspencore}. Како додавање дубоке јаме N типа изискује и додавање заштитног прстена, површина коју заузима дизајн се повећава, тако да то може бити недостатак овог приступа ако су захтјеви за површином стриктни. Углавном то није случај јер су захтјеви за перформансама обично битнији тако да је цијена која се плаћа у површини занемарљива у односу на предности које има изолација NMOS транзистора у погледу смањења шума подлоге.

\section{Закључак} \label{Conclusion}
У овом раду представљена је синтетизабилна дигитална фреквенцијски затворена петља са једноставном али ефикасном архитектуром. Дигитално контролисан осцилатор са прстенастом структуром, састављен од тростатичких инвертора омогућава достизање пристојне резолуције фреквенције и одговарајућих радних перформанси. Додатне предности су му и једноставно управљање, прилагодљивост и једноставна поновна употреба. Представљена су два управљачка режима \FLL-а: двостепени контролер и \PID\ контролер. За сваки од њих је детаљно објашњен начин рада и вјеродостојно су приказане разлике у одзиву система у различитим управљачким режимима. Детаљно је објашњена и обрада у различитим доменима такта, као и методе заштите од метастабилности. \par
\FLL\ из овог рада је потпуно синтетизабилан, имплементиран у SystemVerilog језику за опис хардвера. У зависности од технолошке библиотеке може бити направљен коришћењем само библиотеке стандардних ћелија без преуређивања у току дигиталног пројектовања. Обрађени \FLL\ је послат на производњу у 130\,nm CMOS технологији. \par
Ради додатне верификације направљен је и демонстриран софтверски модел рада читавог \FLL-a написан у Пајтон програмском језику. Поред саме демонстрације рада, захваљујући параметрима које прима, помоћу модела се на бржи и једноставнији начин могу предвидјети исправне вриједности константи које се задају систему (нпр. константе \PID\ контролера), што значајно убрзава пројектовање.\par
У сврху приказа утицаја скалирања технологије на рад система тј. дигитално контролисаног осцилатора као његовог главног дијела, направљено је поређење \DCO-a пројектованог у 130\,nm технологији и \DCO-a са идентичном архитектуром, али у 180\,nm технологији. Упоређени су главни параметри као што су површина, потрошња, као и опсег и резолуција фреквенције при различитим условима рада. \par
Даљи рад на описаном и имплементираном \FLL-у ће укључити тестирање чипа након производње и паковања, као и пројектовање додатних синтетизабилних дигиталних блокова као што је фазно спрегнута петља \engl[PLL]{Phase-Locked Loop}, временско-дигитални претварач \engl[TDC]{Time-to-Digital Converter}, регулатор с ниским падом напона \engl[LDO]{Low-Dropout Regulator} итд.


\makebibliography

\newrefsection
\nocite{*}
{\let\section\oldsection
\printbibliography[keyword=Frequency-locked loop, heading=bibintoc, title={Објављени радови}, resetnumbers]}

\end{document}
