\documentclass[master]{finthesis}

\usepackage[pdftex]{graphicx}
\usepackage{amsmath}

\usepackage{caption}
\usepackage{subcaption}
\captionsetup[figure]{font=footnotesize, justification=centering}
%\captionsetup[table]{font=footnotesize}
\usepackage{tikz}
\usepackage{circuitikz}
%\usetikzlibrary{through, patterns}

%\usepackage[T1]{fontenc}

\usepackage[dvipsnames]{xcolor} % for more colors
\usepackage{amssymb} % for arrow symbol
\usepackage{tikz, pgfplots} % for diagram
\usepackage{schemabloc}  % for tikz trapezium
\usepackage{booktabs} % for bold lines in table
\usepackage{fancyhdr} % for header and footer

% For group PGF plots
\pgfplotsset{compat=newest}
\usetikzlibrary{pgfplots.groupplots}
\usepgfmodule{oo}

% Color variables
\def \CtrlColor        {darkgray}
\def \BBctrlColor      {RoyalBlue}
\def \PIDctrlColor     {OliveGreen}
\def \DCOColor         {BrickRed}
\def \CtrlDecColor     {brown}
\def \CtrlPreprocColor {RoyalPurple}
\def \ClkDivColor      {Goldenrod}
\def \RstnColor        {BurntOrange}

% Abbreviation variables
\def \PLL {PLL} % phase-locked loop
\def \FLL {FLL} % frequency-locked loop
\def \DLL {DLL} % delay-locked loop
\def \DCO {DCO} % digitally controlled oscillator 
\def \PID {PID} % proportional-integral-derivative
\def \P   {P}   % proportional
\def \I   {I}   % integral
\def \D   {D}   % derivative
\def \FCW {FCW} % frequency control word
\def \PWT {PVT} % process-voltage-temperature


\addbibresource{master_rad.bib}

\title{Синтетизабилна дигитална фреквенцијски затворена петља са широким подешавањем до 640\texorpdfstring{\,}{ }MHz у 130\texorpdfstring{\,}{ }nm CMOS технологији}
\author{Ђорђе С. Гачић}
\studid{408/2022}
\advisor{проф. др Владимир М. Миловановић}
\advisorfull{Др Владимир М. Миловановић,\\ванредни професор}

\studprog{Електротехника и рачунарство}
% \module{Модул}
\course{Напредно машинско учење}
\date{\today}
% \date{ГГГГ-ММ-ДД}

\committee{др Шћепан Шћекић}
\committee{доц. др Жарко Попара}

\studentshould{% У оквиру овог рада кандидат треба да...
}

%\titlepagebib{greenwade93}
%\titlepagebib{pythonsite}
\titlepagebib{Staszewski:FREQUENCY_SYNTHESIZER_CMOS_2005}

\thesisapplicationfile{slike/prijava}

\abstracten{Frequency-locked loops (FLLs) represent a viable way of generating a range of frequencies from a single reference frequency by using a negative feedback electronic control system that compares the frequency of a controlled oscillator to the reference one. A digital synthesizable FLL is designed in 130\,nm CMOS technology for a target frequency of up to 640\,MHz. It employs a wide-tuning range digitally controlled oscillator (DCO) assembled from tri-state inverters in the form of a matrix. The FLL can optionally use a bang-bang or a soft-programmable standard proportional-integral-derivative (PID) controller to regulate the feedback loop. Its design practically minimizes metastability occurrence. The proposed digital FLL occupies 100\,\textmu m $\times$ 330\,\textmu m and consumes 3.5\,mW in typical operating conditions. The reference clock is 16\,MHz, and the output oscillation frequency is set to 640\,MHz, while the achieved frequency resolution is 2.8\,MHz.}
\keywordsen{Frequency-locked loop, digitally controlled oscillator, clock generator, synthesizable, CMOS technology, PID controller, metastability}

\abstractsr{Фреквенцијски затворене петље (енгл. \textit{frequency-locked loops - FLLs}) представљају одржив начин генерисања опсега фреквенција из једне референтне фреквенције коришћењем електронског система управљања са негативном повратном спрегом, који пореди фреквенцију контролисаног осцилатора са поменутом референтном фреквенцијом. Дигитално синтетизабилан \FLL\ је дизајниран у 130\,nm технологији за циљану фреквенцију до 640\,MHz. Он погони дигитално контролисани осцилатор (енгл. \textit{digitally-controlled oscillator - DCO}) са широким подешавањем опсега који се састоји од тростатаичких инвертора у облику матрице. \FLL\ може произвољно користити тзв. \textit{bang-bang} контролер или дјелимично програмирани стандардни пропорционално-интегрално-диференцијални (енгл. \textit{proportional-integral-derivative - PID}) контролер за управљање негативном петљом. Такав дизајн у пракси минимизује појаву метастабилности. Предложени дигитални \FLL\ заузима 100\,\textmu m $\times$ 330\,\textmu m простора и троши 3.5\,mW у уобичајеним условима рада. Референтни такт је 16\,MHz, а излазна фреквенција осциловања је подешена на 640\,MHz, док постигнута резолуција фреквенције износи 2.8\,MHz.}
\keywordssr{Фреквенцијски затворена петља, дигитално контролисани осцилатор, генератор такта, синтетизабилност, CMOS технологија, \PID\ контролер, метастабилност}

% Semantic markup. Look it up!
%\newcommand{\cmd}[2][]{\texttt{\textbackslash #2#1\{\ldots\}}} % Well, this one is useful beyond just semantics...
%\newcommand{\env}[1]{\texttt{#1}}
%\newcommand{\pkg}[1]{\texttt{#1}}
%\newcommand{\prog}[1]{\texttt{#1}}

\begin{document}

\maketitle

\tableofcontents

\makeabstract

\section{Увод}
У данашње вријеме, фазно затворена петља (енгл. \textit{phase-locked loop - PLL)} и петља са затвореним кашњењем (енгл. \textit{delay-locked loop - DLL}) представљају свеприсутне блокове у дизајну чипова. Безброј примјена самих чипова захтјевају или генератор такта или синтетизатор фреквенције, што подразумјева уградњу неког од поменутих блокова унутар система који се пројектује. Главна улога таквог блока у дизајну је да генерише стабилан и прецизан излазни сигнал чија је фаза подесива у односу на фазу улазног сигнала, самим тим одржавајући везу између улазне и излазне фреквенције. Међутим, чак и веома сложени системи често захтјевају генератор такта, који само множи улазну фреквенцију без да посебно води рачуна о фази такта или апсолутном подрхтавању (енгл. \textit{jitter}). У таквим примјенама, потребна и довољна је само фреквенцијски затворена петља (енгл. \textit{frequency-locked loop - FLL}) да би се испунили тражени захтјеви.

По дефиницији, \FLL\ је управљачки систем са негативном повратном спрегом који закључава фреквенцију излазног сигнала на предвиђену циљану фреквенцију. У принципу, непрастано управља фреквенцијом осцилатора на аутоматски начин све док излазна фреквенција на достигне циљану вриједност, након чега се та вриједност фреквенција одржава на излазу. Постоје многи начини имплементације \FLL-а~\cite{Ali:9097205}. Штавише, \FLL\ као интегрисано коло може спадати у двије групе: дигитални и аналогни \FLL. Иако је очигледан недостатак првих максимална фреквенција и њена резолуција, они посједују многе друге предности наспрам њихових аналогних супарника. Они заузимају мање простора, истичу се већом отпорношћу на промјене процесних углова, напона и температуре (енгл. \textit{process-voltage-temperature - PVT}), лако су употребљиви у различитим технологијама, и стога омогућавају поновну употребу, већу прилагодљивост, једноставнију методологију тока пројектовања, као и брже циклусе пројектовања. Узимајући у обзир све претходно поменуто, испоставља се да је у општем случају боље ићи ка развоју дигиталног \FLL-a кад год спецификација архитектуре система то дозвољава. Дакле, фокус овог рада је пројектовати и унаприједити једноставне али моћне синтетизабилне дигиталне блокове чипа.

Овај рад конкретно предлаже синтетизабилан дигитални \FLL\ сличан предложеном у литератури~\cite{Musa:6644316}, са побољшаном брзином закључавања \FLL-а~\cite{Deng:6891375} и смањеним ризиком од метастабилности. Осцилатор је састављен од тростатичких инвертора и заснован на прстенастом \DCO-у из литературе~\cite{Tierno:4443210} измјењен додавањем независног напона напајања \DCO-а са мјењачима напонских нивоа (енгл. \textit{level shifters}) и употребом петостепене~\cite{Rylyakov:4523284} умјесто тростепене толологије прстена осцилатора.

Остатак рада укључује додатна поглавља. Поглавље \ref{FLL structure} описује предложени дигитални \FLL\ на системском нивоу и нивоу блокова и кола уз детаљна теоријска разматрања. Поглавље \ref{Implementation and results} пружа увид у имплементацију и добијене резултате симулација, такође уз теоријска разматрања појава које су од значаја за рад читавог система. Коначно, поглавље \ref{Conclusion} закључује рад и наговјештава могућности даљег рада на побољшању и проширењу система.


\section{Структура фреквенцијски затворене петље} \label{FLL structure}


У овом раду описана је релативно једноставна али ефикасна дигитална фреквенцијски затворена петља (\FLL). чију се системску архитектуру на нивоу блокова приказује \figurename~\ref{FLL block diagram}. Описани \FLL\ се практично састоји из два блока: дигитално контролисаног осцилатора (\DCO) и блока управљачке логике, који генерише улазне сигнале за \DCO\ на основу тренутне фреквенције \DCO-a. У сврху поједностављења, са слике су изостављени неки конфигурациони улази \FLL-a, као што су умножак фреквенције (енгл. \textit{frequency control word - FCW}), коефицијенти \PID\ контролера и улаз за одабир режима рада. 

\input{slike/FLL.tex}

\subsection{Управљачка логика дигиталне фреквенцијски затворене петље}
Управљачка логика \FLL-a састоји се од двије независне процесне гране, које представљају два међусобно искључива режима управљања \FLL-a. Оба режима на улазу примају бинарну вриједност повезану са бројем периода такта \DCO-а унутар периода референтног такта. Такође, оба управљачка режима генеришу бинарну вриједност на излазу, која представља управљачку бинарну ријеч осцилатора директно пропорционалну излазној фреквенцији. Главне разлике између два поменута режима су брзина затварања (закључавања) \FLL-a и једноставност подешавања. Циљ управљачке логике \FLL-a је изједначити вриједност улазног множача фреквенције са бројем периода такта \DCO-a унутар периода референтног такта што је брже и прецизније могуће одрадити, чиме се долази до постизања жељене фреквенције на излазу \DCO-a. Комплетна управљачка логика \FLL-a је подјељена на неколико фаза, које су описане у наредним поглављима.

\subsubsection{Управљачка предобрада}
Фаза управљачке предобраде (енгл. \textit{control preprocessing}) укључује неколико блокова чија је функција претворити информацију о фреквенцији излазног такта \DCO-a у бинарну вриједност која ће бити прослијеђена као улаз наредној фази управљачке логике \FLL-a. Као прво, да би се одредила брзина осциловања \DCO-a, потребан је бројач. У имплементацији описаној у овом раду коришћен је Грејев бројач умјесто природног бинарног бројача из разлога што значајно умањује метастабилност бројача изазвану узорковањем (енгл. \textit{sampling}), јер у Грејевом коду свака узастопна вриједност се разликује за по један бит. Недостатак овог приступа је то што Грејев бројач има мању максималну радну фреквенцију од бинарног бројача. Да би се у још већем обиму смањио ризик од метастабилности, сваки бит са излаза Грејевог бројача се пропушта кроз синхронизатор са два флип-флопа да би безбједно прешао у подручје референтног такта. Затим, синхронизована вриједност Грејевог бројача се претвара у бинарни формат и узоркује се за даљу обраду.
% TODO
% Нешто више о Грејевом бројачу

\subsubsection{Bang-bang контролер}
Први управљачки блок \FLL-a је веома сличан bang-bang (или on-off) контролеру, односно контролеру са повратном спрегом који, као прекидач, може имати два стања. Он пореди улазни умножак фреквенције са узоркованом вриједношћу бројача и одлучује да ли инкрементирати, декрементирати или онемогућити предстојећи блок тј. двосмјерни бројач (енгл. \textit{up-down counter}). То осигурава постепено управљање и закључавање све до постизања жељене фреквенције.

% TODO
% Нешто више о bang-bang контролеру

\subsubsection{\PID~контролер}
У другом управљачком режиму, управљачка бинарна ријеч за \DCO\ се генерише подесивим \PID\ контролером. \PID\ контролер је управљачки механизам заснован на повратној спрези, који ради тако што непрекидно исправља и скалира сигнал грешке, који је разлика између измјерене вриједности у обради (узоркована вриједност бројача) и жељене референтне задате вриједности (вриједност улазног умношка фреквенције). Исправљање и скалирање се распоређује у три компоненте: пропорционална (\P), интегрална (\I) и диференцијална (\D), имплементиране као подесиви улази са фиксном тачком који се напајају из банке регистара. \par
Сврха \P\ компоненте је да управља брзином одзива управљачког система, непосредно множећи сигнал грешке константним чиниоцем. \I\ компонента се користи за смањење грешке стабилног стања (енгл. \textit{steady-state}) скалирањем грешке константним чиниоцем и сумирањем резултата током времена. \D\ компонента пропорционална брзини промјене грешке, и њен циљ је ограничити излаз да би се смањила могућа прекорачења или осцилације узроковане \P\ и \I\ компонентама, без смањења брзине контролера. Како је у овом систему референтна задата вриједност константна и нема брзих промјена на улазу које могу изазвати такав исход, \P\ и \I\ компоненте су довољне за гладак и стабилан одзив система.  

% TODO
% Нешто више о PID контролеру

\subsubsection{Управљачки декодер}
Улога управљачког декодера је претворити управљачке податке из једне бинарне вриједности у скуп управљачких улаза \DCO-а. Постоје три таква улаза: \textit{Row On}, унарни вектор, који може да укључује читаве редове тростатичких инвертора \DCO-a; \textit{Row Select}, један од $n$ вектор (енгл. \textit{one-hot vector}), који укључује један додатни ред тростатичких инвертора \DCO-a; и \textit{Column Select}, унарни вектор, који може да укључује колоне тростатичких инвертора \DCO-a. Да би се један инвертор укључио, или \textit{Row On}, или и \textit{Row Select} и \textit{Column Select} за одговарајући бит морају бити подешени на 1. Ширина сваког вектора је једнака ширини улаза. Сама структура \DCO-a је детаљније описана у поглављу \ref{DCO structure}.

% TODO
% Нешто више о унарном и један од n кодирању

\subsection{Структура дигитално контролисаног осцилатора} \label{DCO structure}
У срцу сваке фазно затворене петље се налази осцилатор који игра кључну улогу у учинку који може бити постигнут~\cite{Razavi:PLL_CMOS_2020}.

\subsubsection{Предложена архитектура DCO-a}

\subsubsection{Блок дијаграм DCO ћелије}

\subsubsection{Мјењачи напонских нивоа DCO-a}


\section{Имплементација и резултати симулација} \label{Implementation and results}

\subsection{Симулација рада фреквенцијски затворене петље}

\subsection{PVT зависност дигитално контролисаног осцилатора}

\subsection{Временски прорачун дигитално контролисаног осцилатора}

\subsection{Спектар снаге фреквенцијски затворене петље}

\subsection{Фазни шум дигитално контролисаног осцилатора}


\section{Закључак} \label{Conclusion}


\makebibliography

\end{document}
