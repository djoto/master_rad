\begin{figure}[!ht]
    \centering
    %\vspace{0.2cm}
    \vspace{-0.1cm}
    %\resizebox{10cm}{2cm}{%
    \scalebox{0.78}{
    \begin{tikzpicture}

    % P substrate
    \node[draw, rectangle, fill=red!20, minimum height=3.5cm, minimum width=20.1cm, inner sep=0] (psub) at (2.55,-1.75) {};

    % N well
    \node[draw, rectangle, fill=yellow!30, minimum height=1.3cm, minimum width=6cm, inner sep=0] (nwell) at (-4,-0.65) {};
    
    % Left N well above DNW
    \node[draw, rectangle, fill=yellow!30, minimum height=1.3cm, minimum width=1.6cm, inner sep=0] (nwelldnwleft) at (2,-0.65) {};
    % Right N well above DNW
    \node[draw, rectangle, fill=yellow!30, minimum height=1.3cm, minimum width=1.6cm, inner sep=0] (nwelldnwright) at (10,-0.65) {};
    
    % DNW Rectangle
    \node[draw, rectangle, fill=YellowGreen!30, minimum height=1.3cm, minimum width=8.4cm, inner sep=0] (dnw) at (6,-1.95) {};

    % PMOS Source/Drain (P+ diffusion)
    \node[draw, rectangle, fill=red!60, minimum height=0.5cm, minimum width=1cm, inner sep=0] (psource) at (-6.0,-0.25) {\scriptsize p\,\tiny $+$};
    \node[draw, rectangle, fill=red!60, minimum height=0.5cm, minimum width=1cm, inner sep=0] (pdrain) at (-4.0,-0.25) {\scriptsize p\,\tiny $+$};

    % Guard ring - left tap
    \node[draw, rectangle, fill=red!60, minimum height=0.5cm, minimum width=1cm, inner sep=0] (grleft) at (0.4,-0.25) {\scriptsize p\,\tiny $+$};
    % DNW - left tap
    \node[draw, rectangle, fill=yellow!60, minimum height=0.5cm, minimum width=1cm, inner sep=0] (dnwleft) at (2,-0.25) {\scriptsize n\,\tiny $+$};
    
    % Guard ring - right tap
    \node[draw, rectangle, fill=red!60, minimum height=0.5cm, minimum width=1cm, inner sep=0] (grright) at (11.6,-0.25) {\scriptsize p\,\tiny $+$};
    % DNW - rignt tap
    \node[draw, rectangle, fill=yellow!60, minimum height=0.5cm, minimum width=1cm, inner sep=0] (dnwright) at (10,-0.25) {\scriptsize n\,\tiny $+$};

    % NMOS Source/Drain (N+ diffusion)
    \node[draw, rectangle, fill=yellow!60, minimum height=0.5cm, minimum width=1cm, inner sep=0] (nsource) at (6.0,-0.25) {\scriptsize n\,\tiny $+$};
    \node[draw, rectangle, fill=yellow!60, minimum height=0.5cm, minimum width=1cm, inner sep=0] (ndrain) at (8.0,-0.25) {\scriptsize n\,\tiny $+$};

    % Gate oxide and Gate for PMOS and NMOS
    \node[draw, rectangle, fill=gray!40, minimum height=0.1cm, minimum width=1.6cm, inner sep=0] (pgray) at (-5.0,0.05) {};
    \node[draw, rectangle, fill=gray!40, minimum height=0.1cm, minimum width=1.6cm, inner sep=0] (ngray) at (7.0,0.05) {};
    \node[draw, rectangle, fill=blue!30, minimum height=0.4cm, minimum width=1.4cm, inner sep=0] (pgate) at (-5.0,0.3) {};
    \node[draw, rectangle, fill=blue!30, minimum height=0.4cm, minimum width=1.4cm, inner sep=0] (ngate) at (7.0,0.3) {};

    % Taps and Substrate Contacts
    \node[draw, rectangle, fill=yellow!60, minimum height=0.5cm, minimum width=1cm, inner sep=0] (ntap) at (-2,-0.25) {\scriptsize n\tiny $+$\,\scriptsize tap};
    \node[draw, rectangle, fill=red!60, minimum height=0.5cm, minimum width=1cm, inner sep=0] (ptap) at (4,-0.25) {\scriptsize p\tiny $+$\,\scriptsize tap};

    % NMOS contacts
    \draw (ngate.north) --++ (0,0.5) node[draw, circle, minimum size=0.13cm, inner sep=0, fill=white](ngatecirc){} ++ (0,0.1) node[anchor=south]{\scriptsize G};
    \draw (nsource.north) --++ (0,1) node[draw, circle, minimum size=0.13cm, inner sep=0, fill=white](nsourcecirc){} ++ (0,0.1) node[anchor=south]{\scriptsize S};
    \draw (ndrain.north) --++ (0,1) node[draw, circle, minimum size=0.13cm, inner sep=0, fill=white](ndraincirc){} ++ (0,0.1) node[anchor=south]{\scriptsize D};
    \draw (ntap.north) --++ (0,1) node[draw, circle, minimum size=0.13cm, inner sep=0, fill=white](ntapcirc){} ++ (0,0.05) node[anchor=south]{\scriptsize B ($V_\text{DD}$)};

    % PMOS contacts
    \draw (pgate.north) --++ (0,0.5) node[draw, circle, minimum size=0.13cm, inner sep=0, fill=white](pgatecirc){} ++ (0,0.1) node[anchor=south]{\scriptsize G};
    \draw (psource.north) --++ (0,1) node[draw, circle, minimum size=0.13cm, inner sep=0, fill=white](psourcecirc){} ++ (0,0.1) node[anchor=south]{\scriptsize S};
    \draw (pdrain.north) --++ (0,1) node[draw, circle, minimum size=0.13cm, inner sep=0, fill=white](pdraincirc){} ++ (0,0.1) node[anchor=south]{\scriptsize D};
    \draw (ptap.north) --++ (0,1) node[draw, circle, minimum size=0.13cm, inner sep=0, fill=white](ptapcirc){} ++ (0,0.05) node[anchor=south]{\scriptsize B ($V_\text{SS}$)};

    % Guard Ring contacts
    \draw (grleft.north) --++ (0,1) node[draw, circle, minimum size=0.13cm, inner sep=0, fill=white](grleftcirc){} ++ (0,0.1) node[anchor=south]{\scriptsize $V_\text{SS}$};
    \draw (grright.north) --++ (0,1) node[draw, circle, minimum size=0.13cm, inner sep=0, fill=white](grrightcirc){} ++ (0,0.1) node[anchor=south]{\scriptsize $V_\text{SS}$};

    % Contacts for taps in N-well above DNW
    \draw (dnwleft.north) --++ (0,1) node[draw, circle, minimum size=0.13cm, inner sep=0, fill=white](dnwleftcirc){} ++ (0,0.1) node[anchor=south]{\scriptsize $V_\text{DD}$};
    \draw (dnwright.north) --++ (0,1) node[draw, circle, minimum size=0.13cm, inner sep=0, fill=white](dnwrightcirc){} ++ (0,0.1) node[anchor=south]{\scriptsize $V_\text{DD}$};

    % Curly braces
    \draw[decoration={brace},decorate] (-7,1.7) -- node[above=1pt] {\scriptsize PMOS} (-1,1.7);
    \draw[decoration={brace},decorate] (3,1.7) -- node[above=1pt] {\scriptsize NMOS} (9,1.7);
    
    % Labels
    \draw (nwell.south) ++ (0,0.1) node[anchor=south] {\scriptsize N-Well};
    \draw (psub.south) ++ (0,0.1) node[anchor=south] {\scriptsize P-Substrate};
    \draw (nwelldnwleft.south) ++ (0,0.1) node[anchor=south] {\scriptsize N-Well};
    \draw (nwelldnwright.south) ++ (0,0.1) node[anchor=south] {\scriptsize N-Well};
    \draw (dnw.south) ++ (0,0.1) node[anchor=south] {\scriptsize Deep N-Well};
    \draw (dnw.north) ++ (0,0.1) node[anchor=south] {\scriptsize P-Well};

    % Substrate ground
    \draw (psub.south) node[ground] (gnd) {};

    \end{tikzpicture}
    }
    %\vspace{0.5cm}
    \caption{Попречни пресјек CMOS инвертора са NMOS транзисотром изолованим коришћењем дубоке јаме N типа \engl{Deep N-Well} и додатим заштитним прстеном повезаним на $V_\text{SS}$.}
    \label{fig:dnw:dnw_cmos}
\end{figure}
