\begin{figure}[!ht]
    \centering
    \vspace{-0.1cm}
    %\resizebox{10cm}{2cm}{%
    \scalebox{0.9}{
    \begin{tikzpicture}

    % P substrate
    \node[draw, rectangle, fill=red!20, minimum height=3.5cm, minimum width=17.5cm, inner sep=0] (psub) at (3.855,-1.75) {};

    % N well
    \node[draw, rectangle, fill=yellow!30, minimum height=1.3cm, minimum width=5.8cm, inner sep=0] (nwell) at (-0.1,-0.65) {};
    
    % Right N well above DNW
    \node[draw, rectangle, fill=yellow!30, minimum height=1.3cm, minimum width=1.6cm, inner sep=0] (nwelldnwright) at (10,-0.65) {};
    
    % DNW Rectangle
    \node[draw, rectangle, fill=YellowGreen!30, minimum height=1.3cm, minimum width=8.4cm, inner sep=0] (dnw) at (6,-1.95) {};

    % PMOS Source/Drain (P+ diffusion)
    \node[draw, rectangle, fill=red!55, minimum height=0.5cm, minimum width=1cm, inner sep=0] (psource) at (-2.0,-0.25) {\footnotesize p\,\scriptsize $+$};
    \node[draw, rectangle, fill=red!55, minimum height=0.5cm, minimum width=1cm, inner sep=0] (pdrain) at (0.0,-0.25) {\footnotesize p\,\scriptsize $+$};

    % Guard ring - left tap
    \node[draw, rectangle, fill=red!55, minimum height=0.5cm, minimum width=1cm, inner sep=0] (grleft) at (-3.8,-0.25) {\footnotesize p\,\scriptsize $+$};
    
    % Guard ring - right tap
    \node[draw, rectangle, fill=red!55, minimum height=0.5cm, minimum width=1cm, inner sep=0] (grright) at (11.6,-0.25) {\footnotesize p\,\scriptsize $+$};
    % DNW - rignt tap
    \node[draw, rectangle, fill=yellow, minimum height=0.5cm, minimum width=1cm, inner sep=0] (dnwright) at (10,-0.25) {\footnotesize n\,\scriptsize $+$};

    % NMOS Source/Drain (N+ diffusion)
    \node[draw, rectangle, fill=yellow, minimum height=0.5cm, minimum width=1cm, inner sep=0] (nsource) at (6.0,-0.25) {\footnotesize n\,\scriptsize $+$};
    \node[draw, rectangle, fill=yellow, minimum height=0.5cm, minimum width=1cm, inner sep=0] (ndrain) at (8.0,-0.25) {\footnotesize n\,\scriptsize $+$};

    % Gate oxide and Gate for PMOS and NMOS
    \node[draw, rectangle, fill=gray!40, minimum height=0.1cm, minimum width=1.6cm, inner sep=0] (pgray) at (-1.0,0.05) {};
    \node[draw, rectangle, fill=gray!40, minimum height=0.1cm, minimum width=1.6cm, inner sep=0] (ngray) at (7.0,0.05) {};
    \node[draw, rectangle, fill=blue!30, minimum height=0.4cm, minimum width=1.4cm, inner sep=0] (pgate) at (-1.0,0.3) {};
    \node[draw, rectangle, fill=blue!30, minimum height=0.4cm, minimum width=1.4cm, inner sep=0] (ngate) at (7.0,0.3) {};

    % Taps and Substrate Contacts
    % \node[draw, rectangle, fill=yellow, minimum height=0.5cm, minimum width=1cm, inner sep=0] (ntap) at (2,-0.25) {\footnotesize n\scriptsize $+$\,\footnotesize tap};
    % \node[draw, rectangle, fill=red!55, minimum height=0.5cm, minimum width=1cm, inner sep=0] (ptap) at (4,-0.25) {\footnotesize p\scriptsize $+$\,\footnotesize tap};

    % Taps and Substrate Contacts
    \node[draw, rectangle, fill=yellow, minimum height=0.5cm, minimum width=1cm, inner sep=0] (ntap) at (2,-0.25) {\footnotesize n\scriptsize $+$};
    \node[draw, rectangle, fill=red!55, minimum height=0.5cm, minimum width=1cm, inner sep=0] (ptap) at (4,-0.25) {\footnotesize p\scriptsize $+$};

    % NMOS contacts
    \draw (ngate.north) --++ (0,0.5) node[draw, circle, minimum size=0.13cm, inner sep=0, fill=white](ngatecirc){} ++ (0,0.1) node[anchor=south]{\footnotesize G};
    \draw (nsource.north) --++ (0,1) node[draw, circle, minimum size=0.13cm, inner sep=0, fill=white](nsourcecirc){} ++ (0,0.1) node[anchor=south]{\footnotesize S};
    \draw (ndrain.north) --++ (0,1) node[draw, circle, minimum size=0.13cm, inner sep=0, fill=white](ndraincirc){} ++ (0,0.1) node[anchor=south]{\footnotesize D};
    \draw (ntap.north) --++ (0,1) node[draw, circle, minimum size=0.13cm, inner sep=0, fill=white](ntapcirc){} ++ (0,0.05) node[anchor=south]{\footnotesize B ($V_\text{DD}$)};

    % PMOS contacts
    \draw (pgate.north) --++ (0,0.5) node[draw, circle, minimum size=0.13cm, inner sep=0, fill=white](pgatecirc){} ++ (0,0.1) node[anchor=south]{\footnotesize G};
    \draw (psource.north) --++ (0,1) node[draw, circle, minimum size=0.13cm, inner sep=0, fill=white](psourcecirc){} ++ (0,0.1) node[anchor=south]{\footnotesize S};
    \draw (pdrain.north) --++ (0,1) node[draw, circle, minimum size=0.13cm, inner sep=0, fill=white](pdraincirc){} ++ (0,0.1) node[anchor=south]{\footnotesize D};
    \draw (ptap.north) --++ (0,1) node[draw, circle, minimum size=0.13cm, inner sep=0, fill=white](ptapcirc){} ++ (0,0.05) node[anchor=south]{\footnotesize B ($V_\text{SS}$)};

    % Guard Ring contacts
    \draw (grleft.north) --++ (0,1) node[draw, circle, minimum size=0.13cm, inner sep=0, fill=white](grleftcirc){} ++ (0,0.1) node[anchor=south]{\footnotesize $V_\text{SS}$};
    \draw (grright.north) --++ (0,1) node[draw, circle, minimum size=0.13cm, inner sep=0, fill=white](grrightcirc){} ++ (0,0.1) node[anchor=south]{\footnotesize $V_\text{SS}$};

    % Contacts for taps in N-well above DNW
    \draw (dnwright.north) --++ (0,1) node[draw, circle, minimum size=0.13cm, inner sep=0, fill=white](dnwrightcirc){} ++ (0,0.1) node[anchor=south]{\footnotesize $V_\text{DD}$};

    % Curly braces
    \draw[decoration={brace},decorate] (-3,1.7) -- node[above=1pt] {\footnotesize PMOS} (2.8,1.7);
    \draw[decoration={brace},decorate] (3,1.7) -- node[above=1pt] {\footnotesize NMOS} (9,1.7);
    
    % Labels
    \draw (nwell.south) ++ (0,0.1) node[anchor=south] {\footnotesize N-Well};
    \draw (psub.south) ++ (0,0.1) node[anchor=south] {\footnotesize P-Substrate};
    \draw (nwelldnwright.south) ++ (0,0.1) node[anchor=south] {\footnotesize N-Well};
    \draw (dnw.south) ++ (0,0.1) node[anchor=south] {\footnotesize Deep N-Well};
    \draw (dnw.north) ++ (0,0.1) node[anchor=south] {\footnotesize P-Well};

    % Substrate ground
    \draw (psub.south) node[ground] (gnd) {};

    \end{tikzpicture}
    }
    %\vspace{0.5cm}
    \caption{Попречни пресјек просторно ефикаснијег CMOS инвертора са изолованим NMOS транзистором.}
    \label{fig:dnw:dnw_cmos_compact}
    \vspace{-0.1cm}
\end{figure}
