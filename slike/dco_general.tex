\pgfooclass{InvRow}{
    \method InvRow(){}
    \method apply(#1,#2,#3){
        \draw 
	(#1,#2) node[ieeestd not port, anchor=in, label={[xshift=-0.1cm, yshift=-0.83cm]1}]({#3}0){}
        ({#3}0.out) node[ieeestd not port, anchor=in, label={[xshift=-0.1cm, yshift=-0.83cm]2}]({#3}1){}
	({#3}1.out) --++ (0.7,0) node[anchor=west]{...} ++ (0.65,0) --++ (0.7,0) node[ieeestd not port, anchor=in, label={[xshift=-0.1cm, yshift=-0.83cm]$N$}]({#3}2){};
    }
}
\begin{figure*}[!ht]
\centering
\vspace{0.2cm}
\begin{tikzpicture}[>=triangle 45]
    \ctikzset{tripoles/mos style/arrows}
    \ctikzset{tripoles/pmos style/emptycircle}
    \ctikzset{logic ports=ieee}

    \pgfoonew \invRow=new InvRow()

    \invRow.apply(0,0,i0)
    \invRow.apply(0,1.75,i1)
    \invRow.apply(0,3.5,i2)
    %
    \foreach \x in {0,1,2}
    \draw[] ({i0}\x.out) -- ({i1}\x.out) -- ({i2}\x.out) --++ (0,0.8) node[anchor=west, rotate=90](lcont\x){...};
    \draw[] ({i0}2.in) -- ({i1}2.in) -- ({i2}2.in) --++ (0,0.8) node[anchor=west, rotate=90](lcont6){...};
    \draw ({i0}0.in) -- ({i1}0.in) -- ({i2}0.in) --++ (0,0.8) node[anchor=west, rotate=90](lcont5){...};
    %
    \invRow.apply(0,5.8,i3)
    %
    \foreach \x in {0,1,2}
        \draw (lcont\x.east) -- ({i3}\x.out);
    \draw (lcont5.east) -- ({i3}0.in);
    \draw (lcont6.east) -- ({i3}2.in);
    %
    % BOTTOM ARROWS FOR ALL INVERTERS
    \foreach \r in {1,2,3}{
        \foreach \c in {0,1,2}{
	    \draw[->] ({i\r}\c.down) ++ (0,-0.5) -- ({i\r}\c.down);
        };
    };

    % Circles at inputs and outputs
    \node[circ] at ({i0}0.out){};
    \node[circ] at ({i0}1.out){};
    \node[circ] at ({i0}2.in){};
    \node[circ] at ({i0}2.out){};
    
    \node[circ] at ({i1}0.in){};
    \node[circ] at ({i1}0.out){};
    \node[circ] at ({i1}1.out){};
    \node[circ] at ({i1}2.in){};
    \node[circ] at ({i1}2.out){};

    \node[circ] at ({i2}0.in){};
    \node[circ] at ({i2}0.out){};
    \node[circ] at ({i2}1.out){};
    \node[circ] at ({i2}2.in){};
    \node[circ] at ({i2}2.out){};

    \node[circ] at ({i3}0.in){};
    \node[circ] at ({i3}0.out){};
    \node[circ] at ({i3}1.out){};
    \node[circ] at ({i3}2.in){};
    \node[circ] at ({i3}2.out){};

    %\draw ({i3}0.in) --++ (0,1) --++ (4.05,0) node[anchor=west]{...} ++ (0.65,0) -| ({i3}2.out);
    \draw ({i3}0.in) --++ (0,1) -| ({i3}2.out);

    \draw ({i0}0.out) --++ (0,-1) node[draw, circle, minimum size=0.13cm, inner sep=0, fill=white](ph0){};
    \draw (ph0) ++ (0,-0.1) node[anchor=north]{\scriptsize Фаза 1};

    \draw ({i0}1.out) --++ (0,-1) node[draw, circle, minimum size=0.13cm, inner sep=0, fill=white](ph1){};
    \draw (ph1) ++ (0,-0.1) node[anchor=north]{\scriptsize Фаза 2};
    
    \draw ({i0}2.in) --++ (0,-1) node[draw, circle, minimum size=0.13cm, inner sep=0, fill=white](phNminus1){};
    \draw (phNminus1) ++ (0,-0.1) node[anchor=north]{\scriptsize Фаза $N$-1};
    
    \draw ({i0}2.out) --++ (0,-1) node[draw, circle, minimum size=0.13cm, inner sep=0, fill=white](phN){};
    \draw (phN) ++ (0,-0.1) node[anchor=north]{\scriptsize Фаза $N$};

\end{tikzpicture}
\caption{$N$-степени дигитално контролисани осцилатор.}
\label{fig:dco:general}
\end{figure*}
